<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mesbox Flashcards Pro</title> 
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#111827">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3405/3405802.png">

    <style>
        body {
            background-color: #0f172a;
            color: #e2e8f0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: none; /* Chống kéo nảy trang trên iOS */
        }
        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        .card-container { transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .card-flipped { transform: rotateY(180deg); }
        
        .tab-active { background-color: #3b82f6; color: white; border-color: #3b82f6; }
        .tab-inactive { background-color: #1e293b; color: #94a3b8; border-color: #374151; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-start pt-4 pb-6 px-4">

    <div class="fixed top-3 left-3 z-50 flex gap-2 opacity-30 hover:opacity-100 transition-opacity">
        <button id="btn-export" class="w-8 h-8 bg-slate-800 rounded-full border border-slate-600 text-blue-400 flex items-center justify-center"><i class="fas fa-file-export text-xs"></i></button>
        <button id="btn-import" class="w-8 h-8 bg-slate-800 rounded-full border border-slate-600 text-purple-400 flex items-center justify-center"><i class="fas fa-file-import text-xs"></i></button>
        <input type="file" id="file-import" class="hidden" accept=".json">
    </div>

    <button id="btn-add-modal" class="fixed bottom-6 right-6 w-14 h-14 bg-green-600 hover:bg-green-500 rounded-full text-white shadow-2xl z-50 flex items-center justify-center transition-transform active:scale-90 border-2 border-green-400">
        <i class="fas fa-plus text-2xl"></i>
    </button>

    <div id="add-modal" class="hidden fixed inset-0 bg-black/90 z-[60] flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-slate-800 rounded-2xl w-full max-w-sm p-6 border border-slate-700 shadow-2xl relative">
            <h3 class="text-xl font-bold text-white mb-4 text-center">Thêm Thẻ Mới</h3>
            <div class="space-y-4">
                <input id="input-en" type="text" class="w-full bg-slate-900 border border-slate-600 rounded-lg p-3 text-white focus:border-blue-500 outline-none" placeholder="English (VD: Apple)">
                <input id="input-vi" type="text" class="w-full bg-slate-900 border border-slate-600 rounded-lg p-3 text-white focus:border-blue-500 outline-none" placeholder="Tiếng Việt (VD: Quả táo)">
            </div>
            <div class="flex gap-3 mt-6">
                <button id="btn-cancel" class="flex-1 py-3 bg-slate-700 rounded-xl text-slate-300 font-bold">Hủy</button>
                <button id="btn-save" class="flex-1 py-3 bg-blue-600 rounded-xl text-white font-bold flex justify-center items-center gap-2">
                    <span>Lưu</span> <i id="spinner" class="fas fa-spinner fa-spin hidden"></i>
                </button>
            </div>
        </div>
    </div>

    <div class="w-full max-w-md flex flex-col gap-3 h-full z-10">
        
        <div class="flex justify-between items-end px-1">
            <h1 class="text-2xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-cyan-300">Mesbox <span class="text-white">Flashcards</span></h1>
            <div id="index-display" class="text-xs font-mono text-slate-400 bg-slate-800 px-2 py-1 rounded border border-slate-700">0/0</div>
        </div>

        <div class="flex p-1 bg-slate-800/80 rounded-xl border border-slate-700">
            <button id="tab-learning" class="flex-1 py-2 rounded-lg text-xs sm:text-sm font-bold transition-all tab-active">Đang học <span id="count-learning" class="opacity-70">...</span></button>
            <button id="tab-mastered" class="flex-1 py-2 rounded-lg text-xs sm:text-sm font-bold transition-all tab-inactive">Đã thuộc <span id="count-mastered" class="opacity-70">...</span></button>
        </div>

        <div class="relative">
            <i class="fas fa-search absolute left-4 top-3.5 text-slate-500"></i>
            <input id="search-input" type="text" placeholder="Tìm kiếm..." class="w-full bg-slate-800/80 border border-slate-700 rounded-xl py-3 pl-10 pr-4 text-sm text-white focus:border-blue-500 outline-none" />
        </div>

        <div class="flex justify-between items-center px-1 h-10">
            <button id="btn-toggle-master" class="flex items-center gap-2 px-3 py-1.5 rounded-full bg-slate-800 border border-slate-700 text-slate-300 hover:border-green-500 hover:text-green-400 transition active:scale-95">
                <i id="icon-master" class="far fa-check-circle text-base"></i> 
                <span id="text-master" class="text-[10px] font-bold uppercase tracking-wider">Đã thuộc?</span>
            </button>

            <button id="btn-delete" class="w-8 h-8 flex items-center justify-center rounded-full bg-slate-800 border border-slate-700 text-slate-400 hover:text-red-500 hover:border-red-500 transition active:scale-95">
                <i class="fas fa-trash-alt text-sm"></i>
            </button>
        </div>

        <div id="flashcard-area" class="relative w-full h-80 sm:h-96 cursor-pointer perspective-1000 group mt-1">
            <div id="card-inner" class="relative w-full h-full duration-500 transform-style-3d card-container">
                
                <div class="absolute inset-0 w-full h-full bg-slate-800 rounded-3xl shadow-xl border border-slate-700 backface-hidden overflow-hidden">
                    <span class="absolute top-4 left-4 z-20 text-[10px] font-bold text-blue-400 tracking-widest uppercase bg-blue-500/10 px-2 py-1 rounded">English</span>
                    
                    <div class="absolute inset-0 flex items-center justify-center px-4 z-10">
                        <h2 id="card-front-text" class="text-4xl font-extrabold text-white text-center leading-tight break-words max-w-full drop-shadow-lg pb-10">...</h2>
                    </div>

                    <div class="absolute bottom-4 left-0 w-full flex flex-col items-center gap-2 z-20">
                        <button id="btn-speak-front" class="w-12 h-12 rounded-full bg-blue-600 hover:bg-blue-500 flex items-center justify-center shadow-lg active:scale-95 transition">
                            <i class="fas fa-volume-high text-white text-lg"></i>
                        </button>
                        <p class="text-slate-500 text-[10px] uppercase tracking-widest"><i class="fas fa-hand-pointer animate-bounce mr-1"></i> Tap to flip</p>
                    </div>
                </div>

                <div class="absolute inset-0 w-full h-full bg-white rounded-3xl shadow-xl backface-hidden rotate-y-180 overflow-hidden">
                    <span class="absolute top-4 left-4 z-20 text-[10px] font-bold text-slate-500 tracking-widest uppercase bg-slate-100 px-2 py-1 rounded">Meaning</span>
                    
                    <div class="absolute inset-0 flex flex-col items-center justify-center px-4 z-10 pb-12">
                        <h3 id="card-back-vi" class="text-3xl font-bold text-slate-800 text-center mb-3">...</h3>
                        <div class="px-3 py-1 bg-blue-50 rounded border border-blue-100 mb-4">
                            <p id="card-back-ipa" class="text-lg text-blue-600 font-mono font-medium">...</p>
                        </div>
                    </div>

                    <div class="absolute bottom-0 left-0 w-full border-t border-slate-100 py-3 bg-slate-50/50 flex flex-col items-center gap-2 z-20">
                        <p id="card-back-en" class="text-xs text-slate-400 font-bold uppercase tracking-wider">...</p>
                        <button id="btn-speak-back" class="w-10 h-10 rounded-full bg-white border border-slate-200 text-slate-600 flex items-center justify-center shadow-sm active:scale-95">
                            <i class="fas fa-volume-high"></i>
                        </button>
                    </div>
                </div>

            </div>
        </div>

        <div class="flex justify-between items-center px-6 pb-8 mt-2">
            <button id="btn-prev" class="w-12 h-12 rounded-full bg-slate-800 border border-slate-700 text-slate-400 active:scale-90 shadow-lg flex items-center justify-center"><i class="fas fa-arrow-left"></i></button>
            <span class="text-[10px] text-slate-600 uppercase font-bold tracking-widest">Swipe</span>
            <button id="btn-next" class="w-12 h-12 rounded-full bg-slate-800 border border-slate-700 text-slate-400 active:scale-90 shadow-lg flex items-center justify-center"><i class="fas fa-arrow-right"></i></button>
        </div>
        
        <div id="no-results" class="hidden text-center text-slate-500 mt-10"><p>Trống.</p></div>
    </div>

    <script>
        const defaultData = [
            { en: "feeding", vi: "cho ăn", ipa: "/ˈfiːdɪŋ/" },
            { en: "nursing", vi: "chăm sóc mẹ/bé", ipa: "/ˈnɜːrsɪŋ/" },
            { en: "breastfeeding", vi: "cho bú mẹ", ipa: "/ˈbrɛstˌfiːdɪŋ/" },
            { en: "formula", vi: "sữa công thức", ipa: "/ˈfɔːrmjələ/" },
            { en: "burp", vi: "vỗ ợ", ipa: "/bɜːrp/" },
            { en: "crib", vi: "cũi", ipa: "/krɪb/" },
            { en: "pacifier", vi: "ti giả", ipa: "/ˈpæsɪfaɪər/" },
            { en: "swaddle", vi: "quấn khăn", ipa: "/ˈswɑːdəl/" },
            { en: "wipe", vi: "khăn ướt", ipa: "/waɪp/" },
            { en: "nap", vi: "ngủ ngắn", ipa: "/næp/" },
            { en: "lullaby", vi: "ru ngủ", ipa: "/ˈlʌləbaɪ/" },
            { en: "cradle", vi: "cái nôi", ipa: "/ˈkreɪdəl/" },
            { en: "calm", vi: "trấn an", ipa: "/kɑːm/" },
            { en: "cry", vi: "khóc", ipa: "/kraɪ/" },
            { en: "smile", vi: "cười", ipa: "/smaɪl/" },
            { en: "sneeze", vi: "hắt hơi", ipa: "/sniːz/" },
            { en: "cough", vi: "ho", ipa: "/kɔːf/" },
            { en: "fever", vi: "sốt", ipa: "/ˈfiːvər/" },
            { en: "medicine", vi: "thuốc", ipa: "/ˈmɛdəsən/" },
            { en: "doctor", vi: "bác sĩ", ipa: "/ˈdɑːktər/" },
            { en: "midwife", vi: "nữ hộ sinh", ipa: "/ˈmɪdˌwaɪf/" },
            { en: "clinic", vi: "phòng khám", ipa: "/ˈklɪnɪk/" },
            { en: "appointment", vi: "lịch hẹn", ipa: "/əˈpɔɪntmənt/" },
            { en: "check-up", vi: "khám định kỳ", ipa: "/ˈtʃɛkˌʌp/" },
            { en: "stroller walk", vi: "đẩy xe đi dạo", ipa: "/ˈstroʊlər wɔːk/" },
            { en: "fresh air", vi: "không khí trong lành", ipa: "/frɛʃ ɛr/" },
            { en: "park", vi: "công viên", ipa: "/pɑːrk/" },
            { en: "outside", vi: "bên ngoài", ipa: "/ˈaʊtsaɪd/" },
            { en: "inside", vi: "bên trong", ipa: "/ɪnˈsaɪd/" },
            { en: "grocery", vi: "cửa hàng thực phẩm", ipa: "/ˈɡroʊsəri/" },
            { en: "supermarket", vi: "siêu thị", ipa: "/ˈsuːpərˌmɑːrkɪt/" },
            { en: "shopping list", vi: "danh sách mua", ipa: "/ˈʃɑːpɪŋ lɪst/" },
            { en: "detergent", vi: "nước giặt", ipa: "/dɪˈtɜːrdʒənt/" },
            { en: "softener", vi: "nước xả", ipa: "/ˈsɔːfənər/" },
            { en: "laundry", vi: "giặt giũ", ipa: "/ˈlɔːndri/" },
            { en: "dry", vi: "phơi, sấy", ipa: "/draɪ/" },
            { en: "fold", vi: "gấp", ipa: "/foʊld/" },
            { en: "iron", vi: "ủi", ipa: "/ˈaɪərn/" },
            { en: "trash", vi: "rác", ipa: "/træʃ/" },
            { en: "bin", vi: "thùng rác", ipa: "/bɪn/" },
            { en: "wipe down", vi: "lau sạch", ipa: "/waɪp daʊn/" },
            { en: "mop", vi: "lau sàn", ipa: "/mɑːp/" },
            { en: "sweep", vi: "quét", ipa: "/swiːp/" },
            { en: "tidy", vi: "ngăn nắp", ipa: "/ˈtaɪdi/" },
            { en: "organize", vi: "sắp xếp", ipa: "/ˈɔːrɡənaɪz/" },
            { en: "fridge", vi: "tủ lạnh", ipa: "/frɪdʒ/" },
            { en: "freezer", vi: "ngăn đá", ipa: "/ˈfriːzər/" },
            { en: "stove", vi: "bếp lò", ipa: "/stoʊv/" },
            { en: "oven", vi: "lò nướng", ipa: "/ˈʌvən/" },
            { en: "microwave", vi: "lò vi sóng", ipa: "/ˈmaɪkrəˌweɪv/" },
            { en: "sink", vi: "bồn rửa", ipa: "/sɪŋk/" },
            { en: "tap", vi: "vòi nước", ipa: "/tæp/" },
            { en: "towel", vi: "khăn", ipa: "/ˈtaʊəl/" },
            { en: "tissue", vi: "khăn giấy", ipa: "/ˈtɪʃuː/" },
            { en: "blanket cover", vi: "vỏ chăn", ipa: "/ˈblæŋkɪt ˈkʌvər/" },
            { en: "sheet", vi: "ga giường", ipa: "/ʃiːt/" },
            { en: "mattress", vi: "nệm", ipa: "/ˈmætrəs/" },
            { en: "heater", vi: "máy sưởi", ipa: "/ˈhiːtər/" },
            { en: "shower", vi: "vòi tắm", ipa: "/ˈʃaʊər/" },
            { en: "shampoo", vi: "dầu gội", ipa: "/ʃæmˈpuː/" },
            { en: "soap", vi: "xà phòng", ipa: "/soʊp/" },
            { en: "cream", vi: "kem", ipa: "/kriːm/" },
            { en: "lotion", vi: "kem dưỡng", ipa: "/ˈloʊʃən/" },
            { en: "sanitizer", vi: "dung dịch sát khuẩn", ipa: "/ˈsænɪtaɪzər/" },
            { en: "allergy", vi: "dị ứng", ipa: "/ˈælərdʒi/" },
            { en: "schedule", vi: "lịch", ipa: "/ˈskɛdʒuːl/" },
            { en: "routine", vi: "thói quen hàng ngày", ipa: "/ruːˈtiːn/" },
            { en: "quiet", vi: "yên tĩnh", ipa: "/ˈkwaɪət/" },
            { en: "noise", vi: "tiếng ồn", ipa: "/nɔɪz/" },
            { en: "gentle", vi: "nhẹ nhàng", ipa: "/ˈdʒɛntəl/" },
            { en: "strong", vi: "mạnh", ipa: "/strɔːŋ/" },
            { en: "careful", vi: "cẩn thận", ipa: "/ˈkɛrfəl/" },
            { en: "support", vi: "đỡ, hỗ trợ", ipa: "/səˈpɔːrt/" },
            { en: "lift", vi: "nâng", ipa: "/lɪft/" },
            { en: "drop", vi: "làm rơi", ipa: "/drɑːp/" },
            { en: "spill", vi: "làm đổ", ipa: "/spɪl/" },
            { en: "warm up", vi: "hâm nóng", ipa: "/wɔːrm ʌp/" },
            { en: "cool down", vi: "để nguội", ipa: "/kuːl daʊn/" },
            { en: "measure", vi: "đo", ipa: "/ˈmɛʒər/" },
            { en: "mix", vi: "trộn", ipa: "/mɪks/" },
            { en: "shake", vi: "lắc", ipa: "/ʃeɪk/" },
            { en: "check", vi: "kiểm tra", ipa: "/tʃɛk/" },
            { en: "temperature", vi: "nhiệt độ", ipa: "/ˈtɛmprətʃər/" },
            { en: "soft", vi: "mềm", ipa: "/sɔːft/" },
            { en: "hard", vi: "cứng", ipa: "/hɑːrd/" },
            { en: "heavy", vi: "nặng", ipa: "/ˈhɛvi/" },
            { en: "light-weight", vi: "nhẹ", ipa: "/ˈlaɪt weɪt/" },
            { en: "borrow", vi: "mượn", ipa: "/ˈbɑːroʊ/" },
            { en: "return", vi: "trả", ipa: "/rɪˈtɜːrn/" },
            { en: "visit", vi: "thăm", ipa: "/ˈvɪzɪt/" },
            { en: "neighbor", vi: "hàng xóm", ipa: "/ˈneɪbər/" },
            { en: "welcome", vi: "chào đón", ipa: "/ˈwɛlkəm/" },
            { en: "stay", vi: "ở lại", ipa: "/steɪ/" },
            { en: "leave", vi: "rời đi", ipa: "/liːv/" },
            { en: "come", vi: "đến", ipa: "/kʌm/" },
            { en: "go", vi: "đi", ipa: "/ɡoʊ/" },
            { en: "bring back", vi: "mang về", ipa: "/brɪŋ bæk/" },
            { en: "downstairs", vi: "tầng dưới", ipa: "/ˌdaʊnˈstɛərz/" },
            { en: "upstairs", vi: "tầng trên", ipa: "/ˌʌpˈstɛərz/" },
            { en: "hallway", vi: "hành lang", ipa: "/ˈhɔːlweɪ/" },
            { en: "entrance", vi: "lối vào", ipa: "/ˈɛntrəns/" },
            { en: "backyard", vi: "sân sau", ipa: "/ˈbækˌjɑːrd/" },
            { en: "balcony", vi: "ban công", ipa: "/ˈbælkəni/" },
            { en: "wardrobe", vi: "tủ quần áo", ipa: "/ˈwɔːrdroʊb/" },
            { en: "drawer", vi: "ngăn kéo", ipa: "/drɔːr/" },
            { en: "cupboard", vi: "tủ bếp", ipa: "/ˈkʌbərd/" },
            { en: "kettle", vi: "ấm đun nước", ipa: "/ˈkɛtəl/" },
            { en: "pot", vi: "nồi", ipa: "/pɒt/" },
            { en: "pan", vi: "chảo", ipa: "/pæn/" },
            { en: "lid", vi: "nắp", ipa: "/lɪd/" },
            { en: "plate", vi: "đĩa", ipa: "/pleɪt/" },
            { en: "bowl", vi: "tô", ipa: "/boʊl/" },
            { en: "fork", vi: "nĩa", ipa: "/fɔːrk/" },
            { en: "spoon", vi: "thìa", ipa: "/spuːn/" },
            { en: "knife", vi: "dao", ipa: "/naɪf/" },
            { en: "chop", vi: "chặt, thái", ipa: "/tʃɒp/" },
            { en: "boil", vi: "luộc", ipa: "/bɔɪl/" },
            { en: "steam", vi: "hấp", ipa: "/stiːm/" },
            { en: "fry", vi: "chiên", ipa: "/fraɪ/" },
            { en: "grill", vi: "nướng", ipa: "/ɡrɪl/" },
            { en: "pour", vi: "rót", ipa: "/pɔːr/" },
            { en: "stir", vi: "khuấy", ipa: "/stɜːr/" },
            { en: "taste", vi: "nếm", ipa: "/teɪst/" },
            { en: "salty", vi: "mặn", ipa: "/ˈsɔːlti/" },
            { en: "sweet", vi: "ngọt", ipa: "/swiːt/" },
            { en: "sour", vi: "chua", ipa: "/ˈsaʊər/" },
            { en: "bitter", vi: "đắng", ipa: "/ˈbɪtər/" },
            { en: "fresh", vi: "tươi", ipa: "/frɛʃ/" },
            { en: "frozen", vi: "đông lạnh", ipa: "/ˈfroʊzən/" },
            { en: "expired", vi: "hết hạn", ipa: "/ɪkˈspaɪərd/" },
            { en: "prepare", vi: "chuẩn bị", ipa: "/prɪˈpɛər/" },
            { en: "serve", vi: "dọn món", ipa: "/sɜːrv/" },
            { en: "leftovers", vi: "đồ ăn thừa", ipa: "/ˈlɛftˌoʊvərz/" },
            { en: "container", vi: "hộp đựng", ipa: "/kənˈteɪnər/" },
            { en: "label", vi: "dán nhãn", ipa: "/ˈleɪbəl/" },
            { en: "fridge door", vi: "cửa tủ lạnh", ipa: "/frɪdʒ dɔːr/" },
            { en: "pantry", vi: "tủ đồ khô", ipa: "/ˈpæntri/" },
            { en: "snack", vi: "đồ ăn nhẹ", ipa: "/snæk/" },
            { en: "spices", vi: "gia vị", ipa: "/ˈspaɪsɪz/" },
            { en: "garlic", vi: "tỏi", ipa: "/ˈɡɑːrlɪk/" },
            { en: "ginger", vi: "gừng", ipa: "/ˈdʒɪndʒər/" },
            { en: "onion", vi: "hành tây", ipa: "/ˈʌnjən/" },
            { en: "carrot", vi: "cà rốt", ipa: "/ˈkærət/" },
            { en: "potato", vi: "khoai tây", ipa: "/pəˈteɪtoʊ/" },
            { en: "egg", vi: "trứng", ipa: "/ɛɡ/" },
            { en: "rice", vi: "cơm", ipa: "/raɪs/" },
            { en: "noodle", vi: "mì", ipa: "/ˈnuːdəl/" },
            { en: "porridge", vi: "cháo", ipa: "/ˈpɔːrɪdʒ/" },
            { en: "bath", vi: "tắm", ipa: "/bæθ/" },
            { en: "bathtub", vi: "bồn tắm", ipa: "/ˈbæθˌtʌb/" },
            { en: "warm water", vi: "nước ấm", ipa: "/wɔːrm ˈwɔːtər/" },
            { en: "towel dry", vi: "lau khô", ipa: "/ˈtaʊəl draɪ/" },
            { en: "brush", vi: "chải", ipa: "/brʌʃ/" },
            { en: "comb", vi: "lược", ipa: "/koʊm/" },
            { en: "hair dryer", vi: "máy sấy tóc", ipa: "/ˈhɛr ˌdraɪər/" },
            { en: "pajamas", vi: "đồ ngủ", ipa: "/pəˈdʒæməz/" },
            { en: "socks", vi: "vớ", ipa: "/sɑːks/" },
            { en: "gloves", vi: "găng tay", ipa: "/ɡlʌvz/" },
            { en: "hat", vi: "mũ", ipa: "/hæt/" },
            { en: "jacket", vi: "áo khoác", ipa: "/ˈdʒækɪt/" },
            { en: "blanket wrap", vi: "quấn chăn", ipa: "/ˈblæŋkɪt ræp/" },
            { en: "protect", vi: "bảo vệ", ipa: "/prəˈtɛkt/" },
            { en: "comfort", vi: "dỗ dành", ipa: "/ˈkʌmfərt/" },
            { en: "cuddle", vi: "ôm nhẹ", ipa: "/ˈkʌdəl/" },
            { en: "hold", vi: "bế", ipa: "/hoʊld/" },
            { en: "lay down", vi: "đặt nằm", ipa: "/leɪ daʊn/" },
            { en: "pick up", vi: "bế lên", ipa: "/pɪk ʌp/" },
            { en: "bedtime", vi: "giờ ngủ", ipa: "/ˈbɛdtaɪm/" },
            { en: "morning", vi: "buổi sáng", ipa: "/ˈmɔːrnɪŋ/" },
            { en: "evening", vi: "buổi tối", ipa: "/ˈiːvnɪŋ/" },
            { en: "midnight", vi: "nửa đêm", ipa: "/ˈmɪdnaɪt/" },
            { en: "early", vi: "sớm", ipa: "/ˈɜːrli/" },
            { en: "late", vi: "muộn", ipa: "/leɪt/" },
            { en: "arrive", vi: "đến nơi", ipa: "/əˈraɪv/" },
            { en: "depart", vi: "khởi hành", ipa: "/dɪˈpɑːrt/" },
            { en: "boarding", vi: "lên máy bay", ipa: "/ˈbɔːrdɪŋ/" },
            { en: "check-in", vi: "làm thủ tục", ipa: "/ˈtʃɛk ɪn/" },
            { en: "passport", vi: "hộ chiếu", ipa: "/ˈpæspɔːrt/" },
            { en: "luggage", vi: "hành lý", ipa: "/ˈlʌɡɪdʒ/" },
            { en: "suitcase", vi: "vali", ipa: "/ˈsuːtkeɪs/" },
            { en: "security check", vi: "kiểm tra an ninh", ipa: "/sɪˈkjʊərəti tʃɛk/" },
            { en: "gate", vi: "cổng", ipa: "/ɡeɪt/" },
            { en: "seat", vi: "ghế", ipa: "/siːt/" },
            { en: "window seat", vi: "ghế gần cửa sổ", ipa: "/ˈwɪndoʊ siːt/" },
            { en: "aisle seat", vi: "ghế lối đi", ipa: "/aɪl siːt/" },
            { en: "flight attendant", vi: "tiếp viên", ipa: "/flaɪt əˈtɛndənt/" },
            { en: "water please", vi: "cho tôi nước", ipa: "/ˈwɔːtər pliːz/" },
            { en: "help me", vi: "giúp tôi", ipa: "/hɛlp miː/" },
            { en: "understand", vi: "hiểu", ipa: "/ˌʌndərˈstænd/" },
            { en: "repeat", vi: "nhắc lại", ipa: "/rɪˈpiːt/" },
            { en: "slowly", vi: "chậm", ipa: "/ˈsloʊli/" },
            { en: "thank you", vi: "cảm ơn", ipa: "/ˈθæŋk juː/" },
            { en: "excuse me", vi: "xin lỗi/làm ơn", ipa: "/ɪkˈskjuːz miː/" },
            { en: "shelf", vi: "kệ", ipa: "/ʃɛlf/" },
            { en: "blanket", vi: "chăn", ipa: "/ˈblæŋ.kɪt/" },
            { en: "pillow", vi: "gối", ipa: "/ˈpɪl.oʊ/" },
            { en: "wet wipes", vi: "khăn ướt", ipa: "/wɛt waɪps/" },
            { en: "bottle warmer", vi: "máy hâm bình sữa", ipa: "/ˈbɒt.əl ˈwɔːr.mər/" },
            { en: "stroller", vi: "xe đẩy", ipa: "/ˈstroʊ.lər/" },
            { en: "crib mattress", vi: "nệm cũi", ipa: "/krɪb ˈmæt.rəs/" },
            { en: "babysitter", vi: "người trông trẻ", ipa: "/ˈbeɪ.biˌsɪt.ər/" },
            { en: "laundry basket", vi: "giỏ đựng đồ giặt", ipa: "/ˈlɔːn.dri ˈbæs.kɪt/" },
            { en: "rinse", vi: "xả", ipa: "/rɪns/" },
            { en: "vacuum", vi: "hút bụi", ipa: "/ˈvæk.juːm/" },
            { en: "sanitize", vi: "khử khuẩn", ipa: "/ˈsæn.ɪ.taɪz/" },
            { en: "disinfect", vi: "khử trùng", ipa: "/ˌdɪs.ɪnˈfekt/" },
            { en: "rash", vi: "phát ban", ipa: "/ræʃ/" },
            { en: "ointment", vi: "thuốc mỡ", ipa: "/ˈɔɪnt.mənt/" },
            { en: "fever patch", vi: "miếng hạ sốt", ipa: "/ˈfiː.vər pætʃ/" },
            { en: "soothing", vi: "làm dịu", ipa: "/ˈsuː.ðɪŋ/" },
            { en: "babymonitor", vi: "máy theo dõi trẻ", ipa: "/ˈbeɪ.biˌmɒn.ɪ.tər/" },
            { en: "diaper cream", vi: "kem chống hăm", ipa: "/ˈdaɪ.pər kriːm/" },
            { en: "pacifier clip", vi: "dây giữ ti giả", ipa: "/ˈpæs.ɪ.faɪ.ər klɪp/" },
            { en: "bib", vi: "yếm", ipa: "/bɪb/" },
            { en: "burp cloth", vi: "khăn vải cho bé ợ", ipa: "/bɜːrp klɒθ/" },
            { en: "meal prep", vi: "chuẩn bị bữa ăn", ipa: "/ˈmiːl prep/" },
            { en: "portion", vi: "khẩu phần", ipa: "/ˈpɔːr.ʃən/" },
            { en: "simmer", vi: "ninh nhỏ lửa", ipa: "/ˈsɪm.ər/" },
            { en: "blend", vi: "xay", ipa: "/blend/" },
            { en: "puree", vi: "nghiền nhuyễn", ipa: "/pjʊˈreɪ/" },
            { en: "frying pan", vi: "chảo", ipa: "/ˈfraɪ.ɪŋ pæn/" },
            { en: "chopping board", vi: "thớt", ipa: "/ˈtʃɒp.ɪŋ bɔːrd/" },
            { en: "apron", vi: "tạp dề", ipa: "/ˈeɪ.prən/" },
            { en: "grocery list", vi: "danh sách mua đồ", ipa: "/ˈɡroʊ.sə.ri lɪst/" },
            { en: "receipt", vi: "hóa đơn", ipa: "/rɪˈsiːt/" },
            { en: "refill", vi: "bổ sung", ipa: "/ˈriː.fɪl/" },
            { en: "sponge", vi: "miếng rửa", ipa: "/spʌndʒ/" },
            { en: "trash bag", vi: "túi rác", ipa: "/træʃ bæɡ/" },
            { en: "garbage bin", vi: "thùng rác", ipa: "/ˈɡɑːr.bɪdʒ bɪn/" },
            { en: "recycle", vi: "tái chế", ipa: "/riːˈsaɪ.kəl/" },
            { en: "insurance", vi: "bảo hiểm", ipa: "/ɪnˈʃʊr.əns/" },
            { en: "pharmacy", vi: "hiệu thuốc", ipa: "/ˈfɑːr.mə.si/" },
            { en: "traffic", vi: "giao thông", ipa: "/ˈtræf.ɪk/" },
            { en: "roundabout", vi: "bùng binh", ipa: "/ˈraʊnd.ə.baʊt/" },
            { en: "subway", vi: "tàu điện ngầm", ipa: "/ˈsʌb.weɪ/" },
            { en: "platform", vi: "sân ga", ipa: "/ˈplæt.fɔːrm/" },
            { en: "ticket machine", vi: "máy bán vé", ipa: "/ˈtɪk.ɪt məˌʃiːn/" },
            { en: "fine", vi: "phạt", ipa: "/faɪn/" },
            { en: "landlord", vi: "chủ nhà", ipa: "/ˈlænd.lɔːrd/" },
            { en: "rent", vi: "tiền thuê nhà", ipa: "/rent/" },
            { en: "radiator", vi: "lò sưởi nước", ipa: "/ˈreɪ.di.eɪ.tər/" },
            { en: "curtain", vi: "rèm", ipa: "/ˈkɜːr.tən/" },
            { en: "keychain", vi: "móc chìa khóa", ipa: "/ˈkiː.tʃeɪn/" },
            { en: "mailbox", vi: "hộp thư", ipa: "/ˈmeɪl.bɒks/" },
            { en: "delivery", vi: "giao hàng", ipa: "/dɪˈlɪv.ər.i/" },
            { en: "signature", vi: "chữ ký", ipa: "/ˈsɪɡ.nə.tʃər/" },
            { en: "friendly", vi: "thân thiện", ipa: "/ˈfrend.li/" },
            { en: "polite", vi: "lịch sự", ipa: "/pəˈlaɪt/" },
            { en: "quiet hours", vi: "giờ yên lặng", ipa: "/ˈkwaɪ.ət aʊərz/" },
            { en: "recycling room", vi: "phòng phân loại rác", ipa: "/riːˈsaɪ.klɪŋ ruːm/" },
            { en: "snow", vi: "tuyết", ipa: "/snoʊ/" },
            { en: "slippery", vi: "trơn", ipa: "/ˈslɪp.ər.i/" },
            { en: "boots", vi: "giày boots", ipa: "/buːts/" },
            { en: "basement", vi: "tầng hầm", ipa: "/ˈbeɪs.mənt/" },
            { en: "attic", vi: "gác mái", ipa: "/ˈæt.ɪk/" },
            { en: "doorstep", vi: "bậc cửa", ipa: "/ˈdɔːr.step/" },
            { en: "intercom", vi: "chuông liên lạc", ipa: "/ˈɪn.tər.kɒm/" },
            { en: "security code", vi: "mã mở cửa", ipa: "/sɪˈkjʊr.ə.ti koʊd/" },
            { en: "emergency", vi: "tình huống khẩn cấp", ipa: "/ɪˈmɜːr.dʒən.si/" },
            { en: "ambulance", vi: "xe cứu thương", ipa: "/ˈæm.bjʊ.ləns/" },
            { en: "fire alarm", vi: "báo cháy", ipa: "/ˈfaɪər əˌlɑːrm/" },
            { en: "exit", vi: "lối ra", ipa: "/ˈeɡ.zɪt/" },
            { en: "stairs", vi: "cầu thang", ipa: "/sterz/" },
            { en: "elevator", vi: "thang máy", ipa: "/ˈel.ə.veɪ.tər/" },
            { en: "railing", vi: "tay vịn", ipa: "/ˈreɪ.lɪŋ/" },
            { en: "oven mitts", vi: "găng chống nóng", ipa: "/ˈʌv.ən mɪts/" },
            { en: "pressure cooker", vi: "nồi áp suất", ipa: "/ˈpreʃ.ər ˈkʊk.ər/" },
            { en: "ladle", vi: "muôi", ipa: "/ˈleɪ.dl/" },
            { en: "spatula", vi: "cái xẻng lật", ipa: "/ˈspætʃ.ə.lə/" },
            { en: "pot lid", vi: "nắp nồi", ipa: "/pɒt lɪd/" },
            { en: "groceries", vi: "đồ tạp hóa", ipa: "/ˈɡroʊ.sər.iz/" },
            { en: "butcher", vi: "cửa hàng thịt", ipa: "/ˈbʊtʃ.ər/" },
            { en: "bakery", vi: "tiệm bánh", ipa: "/ˈbeɪ.kər.i/" },
            { en: "dairy", vi: "đồ từ sữa", ipa: "/ˈder.i/" },
            { en: "expiration date", vi: "hạn sử dụng", ipa: "/ˌek.spəˈreɪ.ʃən deɪt/" },
            { en: "seasoning", vi: "gia vị", ipa: "/ˈsiː.zən.ɪŋ/" },
            { en: "parsley", vi: "rau mùi tây", ipa: "/ˈpɑːr.sli/" },
            { en: "mint", vi: "bạc hà", ipa: "/mɪnt/" },
            { en: "cinnamon", vi: "quế", ipa: "/ˈsɪn.ə.mən/" },
            { en: "napkin", vi: "khăn ăn", ipa: "/ˈnæp.kɪn/" },
            { en: "dining table", vi: "bàn ăn", ipa: "/ˈdaɪ.nɪŋ ˌteɪ.bəl/" },
            { en: "sofa", vi: "ghế sofa", ipa: "/ˈsoʊ.fə/" },
            { en: "cushion", vi: "gối tựa", ipa: "/ˈkʊʃ.ən/" },
            { en: "carpet", vi: "thảm", ipa: "/ˈkɑːr.pɪt/" },
            { en: "wardrobe hanger", vi: "móc áo", ipa: "/ˈhæŋ.ər/" },
            { en: "laundry detergent pod", vi: "viên giặt", ipa: "/ˈlɔːn.dri pɒd/" },
            { en: "ironing board", vi: "bàn ủi", ipa: "/ˈaɪə.rɪŋ bɔːrd/" },
            { en: "wrinkle", vi: "nhăn", ipa: "/ˈrɪŋ.kəl/" },
            { en: "hang", vi: "treo", ipa: "/hæŋ/" },
            { en: "grocery cart", vi: "xe đẩy siêu thị", ipa: "/ˈɡroʊ.sə.ri kɑːrt/" },
            { en: "aisle", vi: "lối đi siêu thị", ipa: "/aɪl/" },
            { en: "barcode", vi: "mã vạch", ipa: "/ˈbɑːr.koʊd/" },
            { en: "refund", vi: "hoàn tiền", ipa: "/ˈriː.fʌnd/" },
            { en: "exchange", vi: "đổi hàng", ipa: "/ɪksˈtʃeɪndʒ/" },
            { en: "fitting room", vi: "phòng thử đồ", ipa: "/ˈfɪt.ɪŋ ruːm/" },
            { en: "winter coat", vi: "áo khoác mùa đông", ipa: "/ˈwɪn.tər koʊt/" },
            { en: "scarf", vi: "khăn choàng", ipa: "/skɑːrf/" },
            { en: "thermal shirt", vi: "áo giữ nhiệt", ipa: "/ˈθɝː.məl ʃɜːrt/" },
            { en: "indoor shoes", vi: "dép đi trong nhà", ipa: "/ˈɪn.dɔːr ʃuːz/" },
            { en: "humidifier", vi: "máy tạo ẩm", ipa: "/hjuːˈmɪd.ə.faɪ.ər/" },
            { en: "air purifier", vi: "máy lọc không khí", ipa: "/ˈer ˌpjʊr.ə.faɪ.ər/" },
            { en: "thermostat", vi: "bộ điều nhiệt", ipa: "/ˈθɝː.mə.stæt/" },
            { en: "fuse box", vi: "hộp cầu chì", ipa: "/fjuːz bɒks/" },
            { en: "power outlet", vi: "ổ cắm", ipa: "/ˈpaʊ.ər ˌaʊt.lɪt/" },
            { en: "charger", vi: "bộ sạc", ipa: "/ˈtʃɑːr.dʒər/" },
            { en: "screen", vi: "màn hình", ipa: "/skriːn/" },
            { en: "Wi-Fi password", vi: "mật khẩu Wi-Fi", ipa: "/ˈwaɪ.faɪ ˈpæs.wɜːrd/" },
            { en: "connection", vi: "kết nối", ipa: "/kəˈnek.ʃən/" },
            { en: "headset", vi: "tai nghe chụp", ipa: "/ˈhed.set/" },
            { en: "voicemail", vi: "hộp thư thoại", ipa: "/ˈvɔɪs.meɪl/" },
            { en: "ringtone", vi: "nhạc chuông", ipa: "/ˈrɪŋ.toʊn/" },
            { en: "charging cable", vi: "dây sạc", ipa: "/ˈtʃɑːr.dʒɪŋ ˌkeɪ.bəl/" },
            { en: "appointment letter", vi: "giấy hẹn", ipa: "/əˈpɔɪnt.mənt ˈlet.ər/" },
            { en: "registration", vi: "đăng ký", ipa: "/ˌredʒ.ɪˈstreɪ.ʃən/" },
            { en: "stroller ramp", vi: "đường dốc cho xe đẩy", ipa: "/ˈræmp/" },
            { en: "baby carrier", vi: "địu em bé", ipa: "/ˈbeɪ.bi ˌkær.i.ər/" },
            { en: "teething toy", vi: "đồ gặm nướu", ipa: "/ˈtiː.ðɪŋ tɔɪ/" },
            { en: "newborn checkup", vi: "kiểm tra trẻ sơ sinh", ipa: "/ˈtʃek.ʌp/" },
            { en: "pediatrician", vi: "bác sĩ nhi", ipa: "/ˌpiː.di.əˈtrɪʃ.ən/" },
            { en: "symptoms", vi: "triệu chứng", ipa: "/ˈsɪmp.təmz/" },
            { en: "appointment card", vi: "thẻ lịch hẹn", ipa: "/əˈpɔɪnt.mənt kɑːrd/" },
            { en: "breastfeeding pillow", vi: "gối cho bú", ipa: "/ˈbrestˌfiːdɪŋ ˈpɪl.oʊ/" },
            { en: "nursing bra", vi: "áo lót cho mẹ bỉm", ipa: "/ˈnɜː.sɪŋ brɑː/" },
            { en: "pumping", vi: "hút sữa", ipa: "/ˈpʌmp.ɪŋ/" },
            { en: "milk storage bag", vi: "túi trữ sữa", ipa: "/stɔːr.ɪdʒ bæɡ/" },
            { en: "bedtime routine", vi: "thói quen trước khi ngủ", ipa: "/ˈbed.taɪm ruːˌtiːn/" },
            { en: "better", vi: "tốt hơn", ipa: "/ˈbɛ.tɜ/" },
            { en: "soothing light", vi: "đèn dịu", ipa: "/ˈsuː.ðɪŋ laɪt/" },
            { en: "breastfeeding station", vi: "góc cho bú", ipa: "/ˈsteɪ.ʃən/" },
            { en: "baby-proof", vi: "chống nguy hiểm cho bé", ipa: "/ˈbeɪ.bi pruːf/" },
            { en: "cabinet lock", vi: "khóa tủ an toàn", ipa: "/ˈkæb.ɪ.nət lɒk/" },
            { en: "corner guard", vi: "miếng ốp góc", ipa: "/ˈkɔːr.nər ɡɑːrd/" },
            { en: "playmat", vi: "thảm chơi", ipa: "/ˈpleɪ.mæt/" },
            { en: "storybook", vi: "sách truyện", ipa: "/ˈstɔːr.i.bʊk/" },
            { en: "stroller cover", vi: "áo che xe đẩy", ipa: "/ˈkʌv.ər/" },
            { en: "laundry net", vi: "túi giặt lưới", ipa: "/net/" },
            { en: "detergent-free", vi: "không chất tẩy", ipa: "/dɪˈtɜː.dʒənt friː/" },
            { en: "hello", vi: "xin chào", ipa: "/həˈloʊ/" },
            { en: "good morning", vi: "chào buổi sáng", ipa: "/ɡʊd ˈmɔːrnɪŋ/" },
            { en: "good evening", vi: "chào buổi tối", ipa: "/ɡʊd ˈiːvnɪŋ/" },
            { en: "please", vi: "làm ơn", ipa: "/pliːz/" },
            { en: "sorry", vi: "xin lỗi", ipa: "/ˈsɑːri/" },
            { en: "yes", vi: "vâng", ipa: "/jɛs/" },
            { en: "no", vi: "không", ipa: "/noʊ/" },
            { en: "maybe", vi: "có thể", ipa: "/ˈmeɪbi/" },
            { en: "daughter", vi: "con gái", ipa: "/ˈdɔːtər/" },
            { en: "son-in-law", vi: "con rể", ipa: "/ˈsʌn ɪn lɔː/" },
            { en: "baby", vi: "em bé", ipa: "/ˈbeɪbi/" },
            { en: "newborn", vi: "trẻ sơ sinh", ipa: "/ˈnuːˌbɔːrn/" },
            { en: "mother", vi: "mẹ", ipa: "/ˈmʌðər/" },
            { en: "grandmother", vi: "bà", ipa: "/ˈɡrænˌmʌðər/" },
            { en: "family", vi: "gia đình", ipa: "/ˈfæməli/" },
            { en: "home", vi: "nhà", ipa: "/hoʊm/" },
            { en: "room", vi: "phòng", ipa: "/ruːm/" },
            { en: "kitchen", vi: "nhà bếp", ipa: "/ˈkɪtʃɪn/" },
            { en: "bathroom", vi: "phòng tắm", ipa: "/ˈbæθruːm/" },
            { en: "living room", vi: "phòng khách", ipa: "/ˈlɪvɪŋ ruːm/" },
            { en: "bed", vi: "giường", ipa: "/bɛd/" },
            { en: "clothes", vi: "quần áo", ipa: "/kloʊðz/" },
            { en: "diaper", vi: "tã", ipa: "/ˈdaɪpər/" },
            { en: "milk", vi: "sữa", ipa: "/mɪlk/" },
            { en: "bottle", vi: "bình sữa", ipa: "/ˈbɑːtəl/" },
            { en: "warm", vi: "ấm", ipa: "/wɔːrm/" },
            { en: "cold", vi: "lạnh", ipa: "/koʊld/" },
            { en: "hungry", vi: "đói", ipa: "/ˈhʌŋɡri/" },
            { en: "sleepy", vi: "buồn ngủ", ipa: "/ˈsliːpi/" },
            { en: "tired", vi: "mệt", ipa: "/ˈtaɪərd/" },
            { en: "rest", vi: "nghỉ ngơi", ipa: "/rɛst/" },
            { en: "carry", vi: "bế, mang", ipa: "/ˈkæri/" },
            { en: "clean", vi: "dọn, sạch", ipa: "/kliːn/" },
            { en: "wash", vi: "rửa", ipa: "/wɑːʃ/" },
            { en: "cook", vi: "nấu ăn", ipa: "/kʊk/" },
            { en: "vegetables", vi: "rau", ipa: "/ˈvɛdʒtəbəlz/" },
            { en: "meat", vi: "thịt", ipa: "/miːt/" },
            { en: "soup", vi: "súp", ipa: "/suːp/" },
            { en: "tea", vi: "trà", ipa: "/tiː/" },
            { en: "water", vi: "nước", ipa: "/ˈwɔːtər/" },
            { en: "cup", vi: "cốc", ipa: "/kʌp/" },
            { en: "table", vi: "bàn", ipa: "/ˈteɪbəl/" },
            { en: "chair", vi: "ghế", ipa: "/tʃɛr/" },
            { en: "floor", vi: "sàn nhà", ipa: "/flɔːr/" },
            { en: "door", vi: "cửa", ipa: "/dɔːr/" },
            { en: "window", vi: "cửa sổ", ipa: "/ˈwɪndoʊ/" },
            { en: "light", vi: "đèn", ipa: "/laɪt/" },
            { en: "dark", vi: "tối", ipa: "/dɑːrk/" },
            { en: "afternoon", vi: "buổi chiều", ipa: "/ˌæftərˈnuːn/" },
            { en: "night", vi: "ban đêm", ipa: "/naɪt/" },
            { en: "today", vi: "hôm nay", ipa: "/təˈdeɪ/" },
            { en: "tomorrow", vi: "ngày mai", ipa: "/təˈmɑːroʊ/" },
            { en: "yesterday", vi: "hôm qua", ipa: "/ˈjɛstərdeɪ/" },
            { en: "now", vi: "bây giờ", ipa: "/naʊ/" },
            { en: "later", vi: "lát nữa", ipa: "/ˈleɪtər/" },
            { en: "always", vi: "luôn luôn", ipa: "/ˈɔːlweɪz/" },
            { en: "sometimes", vi: "thỉnh thoảng", ipa: "/ˈsʌmtaɪmz/" },
            { en: "never", vi: "không bao giờ", ipa: "/ˈnɛvər/" },
            { en: "need", vi: "cần", ipa: "/niːd/" },
            { en: "want", vi: "muốn", ipa: "/wɑːnt/" },
            { en: "like", vi: "thích", ipa: "/laɪk/" },
            { en: "help", vi: "giúp", ipa: "/hɛlp/" },
            { en: "bring", vi: "mang đến", ipa: "/brɪŋ/" },
            { en: "give", vi: "đưa", ipa: "/ɡɪv/" },
            { en: "take", vi: "lấy, mang đi", ipa: "/teɪk/" },
            { en: "open", vi: "mở", ipa: "/ˈoʊpən/" },
            { en: "close", vi: "đóng", ipa: "/kloʊz/" },
            { en: "turn on", vi: "bật", ipa: "/tɜːrn ɑːn/" },
            { en: "turn off", vi: "tắt", ipa: "/tɜːrn ɔːf/" },
            { en: "hot", vi: "nóng", ipa: "/hɑːt/" },
            { en: "cool", vi: "mát", ipa: "/kuːl/" },
            { en: "dirty", vi: "bẩn", ipa: "/ˈdɜːrti/" },
            { en: "safe", vi: "an toàn", ipa: "/seɪf/" },
            { en: "slow", vi: "chậm", ipa: "/sloʊ/" },
            { en: "fast", vi: "nhanh", ipa: "/fæst/" },
            { en: "wait", vi: "đợi", ipa: "/weɪt/" },
            { en: "listen", vi: "nghe", ipa: "/ˈlɪsən/" },
            { en: "look", vi: "nhìn", ipa: "/lʊk/" },
            { en: "watch", vi: "xem", ipa: "/wɑːtʃ/" },
        ];

        // --- 2. LOGIC ---
        let currentMode = 'learning'; // 'learning' or 'mastered'

        // Shuffle
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function loadData() {
            const storedPersonal = localStorage.getItem('my_flashcards');
            const personalData = storedPersonal ? JSON.parse(storedPersonal) : [];
            const storedMastered = localStorage.getItem('my_mastered_list');
            const masteredList = storedMastered ? JSON.parse(storedMastered) : [];

            // Merge
            const allData = [...personalData, ...defaultData];

            // Counts
            const masteredCount = allData.filter(item => masteredList.includes(item.en)).length;
            const learningCount = allData.length - masteredCount;

            // Update UI
            const elLearning = document.getElementById('count-learning');
            const elMastered = document.getElementById('count-mastered');
            if(elLearning) elLearning.textContent = `(${learningCount})`;
            if(elMastered) elMastered.textContent = `(${masteredCount})`;

            // Filter
            let resultData = [];
            if (currentMode === 'learning') {
                resultData = allData.filter(item => !masteredList.includes(item.en));
            } else {
                resultData = allData.filter(item => masteredList.includes(item.en));
            }

            return shuffleArray(resultData);
        }

        // Init
        let fullData = loadData(); 
        let filteredData = [...fullData];
        let currentIndex = 0;
        let isFlipped = false;

        // Elements
        const els = {
            cardInner: document.getElementById('card-inner'),
            frontText: document.getElementById('card-front-text'),
            backVi: document.getElementById('card-back-vi'),
            backIpa: document.getElementById('card-back-ipa'),
            backEn: document.getElementById('card-back-en'),
            indexDisplay: document.getElementById('index-display'),
            searchInput: document.getElementById('search-input'),
            btnPrev: document.getElementById('btn-prev'),
            btnNext: document.getElementById('btn-next'),
            btnSpeakFront: document.getElementById('btn-speak-front'),
            btnSpeakBack: document.getElementById('btn-speak-back'),
            flashcardArea: document.getElementById('flashcard-area'),
            noResults: document.getElementById('no-results'),
            addModal: document.getElementById('add-modal'),
            btnAddModal: document.getElementById('btn-add-modal'),
            btnCancel: document.getElementById('btn-cancel'),
            btnSave: document.getElementById('btn-save'),
            inputEn: document.getElementById('input-en'),
            inputVi: document.getElementById('input-vi'),
            spinner: document.getElementById('spinner'),
            btnDelete: document.getElementById('btn-delete'),
            btnExport: document.getElementById('btn-export'),
            btnImport: document.getElementById('btn-import'),
            fileImport: document.getElementById('file-import'),
            tabLearning: document.getElementById('tab-learning'),
            tabMastered: document.getElementById('tab-mastered'),
            btnToggleMaster: document.getElementById('btn-toggle-master'),
            iconMaster: document.getElementById('icon-master'),
            textMaster: document.getElementById('text-master')
        };

        // Render
        function renderCard() {
            if (filteredData.length === 0) {
                els.flashcardArea.style.display = 'none';
                els.noResults.classList.remove('hidden');
                els.noResults.innerHTML = currentMode === 'learning' 
                    ? '<i class="fas fa-check-circle text-4xl mb-2 text-green-500"></i><p class="mt-2 font-medium">Tuyệt vời! Bạn đã thuộc hết rồi.</p>' 
                    : '<i class="fas fa-book-open text-4xl mb-2 text-slate-600"></i><p class="mt-2 font-medium">Chưa có thẻ nào đã thuộc.</p>';
                els.indexDisplay.textContent = "0 / 0";
                return;
            }

            els.flashcardArea.style.display = 'block';
            els.noResults.classList.add('hidden');

            const card = filteredData[currentIndex];
            els.frontText.textContent = card.en;
            els.backVi.textContent = card.vi;
            els.backIpa.textContent = card.ipa || "/.../"; 
            els.backEn.textContent = card.en;

            els.indexDisplay.textContent = `${currentIndex + 1} / ${filteredData.length}`;
            
            // Update Master Button state
            if (currentMode === 'learning') {
                els.iconMaster.className = "far fa-check-circle text-lg group-hover:scale-110 transition-transform";
                els.textMaster.textContent = "Đã thuộc?";
                els.btnToggleMaster.className = "flex items-center gap-2 px-3 py-1.5 rounded-full bg-slate-800 border border-slate-700 text-slate-300 hover:border-green-500 hover:text-green-400 transition active:scale-95";
            } else {
                els.iconMaster.className = "fas fa-times-circle text-lg group-hover:scale-110 transition-transform";
                els.textMaster.textContent = "Học lại";
                els.btnToggleMaster.className = "flex items-center gap-2 px-3 py-1.5 rounded-full bg-slate-800 border border-slate-700 text-slate-300 hover:border-yellow-500 hover:text-yellow-400 transition active:scale-95";
            }

            els.btnPrev.disabled = filteredData.length <= 1;
            els.btnNext.disabled = filteredData.length <= 1;
            els.btnPrev.style.opacity = filteredData.length <= 1 ? "0.3" : "1";
            els.btnNext.style.opacity = filteredData.length <= 1 ? "0.3" : "1";
        }

        // --- CORE FUNCTIONS ---
        function flipCard() {
            isFlipped = !isFlipped;
            els.cardInner.classList.toggle('card-flipped', isFlipped);
        }

        function nextCard() {
            if (filteredData.length <= 1) return;
            isFlipped = false;
            els.cardInner.classList.remove('card-flipped');
            setTimeout(() => {
                currentIndex = (currentIndex + 1) % filteredData.length;
                renderCard();
            }, 150);
        }

        function prevCard() {
            if (filteredData.length <= 1) return;
            isFlipped = false;
            els.cardInner.classList.remove('card-flipped');
            setTimeout(() => {
                currentIndex = (currentIndex - 1 + filteredData.length) % filteredData.length;
                renderCard();
            }, 150);
        }

        function speak(text) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US';
                utterance.rate = 0.9;
                window.speechSynthesis.speak(utterance);
            }
        }

        // --- EVENT LISTENERS ---
        
        // Mode Switch
        function setMode(mode) {
            currentMode = mode;
            if (mode === 'learning') {
                els.tabLearning.className = "flex-1 py-2 rounded-lg text-xs sm:text-sm font-bold transition-all tab-active";
                els.tabMastered.className = "flex-1 py-2 rounded-lg text-xs sm:text-sm font-bold transition-all tab-inactive";
            } else {
                els.tabLearning.className = "flex-1 py-2 rounded-lg text-xs sm:text-sm font-bold transition-all tab-inactive";
                els.tabMastered.className = "flex-1 py-2 rounded-lg text-xs sm:text-sm font-bold transition-all tab-active";
            }
            fullData = loadData();
            filteredData = [...fullData];
            currentIndex = 0;
            isFlipped = false;
            els.cardInner.classList.remove('card-flipped');
            els.searchInput.value = ''; 
            renderCard();
        }
        els.tabLearning.addEventListener('click', () => setMode('learning'));
        els.tabMastered.addEventListener('click', () => setMode('mastered'));

        // Toggle Master
        els.btnToggleMaster.addEventListener('click', (e) => {
            e.stopPropagation();
            const currentCard = filteredData[currentIndex];
            if (!currentCard) return;

            const storedMastered = localStorage.getItem('my_mastered_list');
            let masteredList = storedMastered ? JSON.parse(storedMastered) : [];

            if (currentMode === 'learning') {
                if (!masteredList.includes(currentCard.en)) {
                    masteredList.push(currentCard.en);
                    localStorage.setItem('my_mastered_list', JSON.stringify(masteredList));
                    // Animation Fade Out
                    els.flashcardArea.classList.add('opacity-0', 'scale-95', 'transition-all');
                    setTimeout(() => {
                        fullData = loadData(); 
                        filteredData = [...fullData];
                        if (currentIndex >= filteredData.length) currentIndex = 0;
                        renderCard();
                        els.flashcardArea.classList.remove('opacity-0', 'scale-95');
                    }, 300);
                }
            } else {
                masteredList = masteredList.filter(word => word !== currentCard.en);
                localStorage.setItem('my_mastered_list', JSON.stringify(masteredList));
                // Animation Fade Out
                els.flashcardArea.classList.add('opacity-0', 'scale-95', 'transition-all');
                setTimeout(() => {
                    fullData = loadData();
                    filteredData = [...fullData];
                    if (currentIndex >= filteredData.length) currentIndex = 0;
                    renderCard();
                    els.flashcardArea.classList.remove('opacity-0', 'scale-95');
                }, 300);
            }
        });

        // Add Modal
        els.btnAddModal.addEventListener('click', () => {
            els.addModal.classList.remove('hidden');
            els.inputEn.focus();
        });
        els.btnCancel.addEventListener('click', () => {
            els.addModal.classList.add('hidden');
            els.inputEn.value = ''; els.inputVi.value = '';
        });

        async function fetchIPA(word) {
            try {
                const res = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
                const data = await res.json();
                if (Array.isArray(data) && data.length > 0) return data[0].phonetic || (data[0].phonetics.find(p => p.text)?.text) || "";
                return "";
            } catch (err) { return ""; }
        }

        els.btnSave.addEventListener('click', async () => {
            const en = els.inputEn.value.trim();
            const vi = els.inputVi.value.trim();
            if (!en || !vi) { alert("Thiếu thông tin!"); return; }

            const stored = localStorage.getItem('my_flashcards');
            const personalData = stored ? JSON.parse(stored) : [];
            if (personalData.some(c => c.en.toLowerCase() === en.toLowerCase())) {
                if(!confirm("Từ này đã thêm rồi. Thêm nữa không?")) return;
            }

            els.btnSave.disabled = true;
            els.spinner.classList.remove('hidden');

            let ipa = await fetchIPA(en);
            if (!ipa) ipa = "/.../"; 

            const newCard = { en, vi, ipa };
            personalData.unshift(newCard); 
            localStorage.setItem('my_flashcards', JSON.stringify(personalData));

            if (currentMode !== 'learning') setMode('learning');
            else {
                fullData = loadData();
                filteredData = [...fullData];
                const newIndex = filteredData.findIndex(item => item.en === en);
                currentIndex = newIndex !== -1 ? newIndex : 0;
                renderCard();
            }

            els.inputEn.value = ''; els.inputVi.value = '';
            els.addModal.classList.add('hidden');
            els.btnSave.disabled = false;
            els.spinner.classList.add('hidden');
        });

        // Delete
        els.btnDelete.addEventListener('click', (e) => {
            e.stopPropagation(); 
            const currentCard = filteredData[currentIndex];
            const stored = localStorage.getItem('my_flashcards');
            let personalData = stored ? JSON.parse(stored) : [];
            const indexToDelete = personalData.findIndex(item => item.en === currentCard.en && item.vi === currentCard.vi);

            if (indexToDelete !== -1) {
                if (confirm(`Xóa vĩnh viễn "${currentCard.en}"?`)) {
                    personalData.splice(indexToDelete, 1);
                    localStorage.setItem('my_flashcards', JSON.stringify(personalData));
                    
                    // Also remove from Mastered list if exists
                    const storedMastered = localStorage.getItem('my_mastered_list');
                    let masteredList = storedMastered ? JSON.parse(storedMastered) : [];
                    if (masteredList.includes(currentCard.en)) {
                        masteredList = masteredList.filter(w => w !== currentCard.en);
                        localStorage.setItem('my_mastered_list', JSON.stringify(masteredList));
                    }

                    fullData = loadData();
                    if (els.searchInput.value) {
                         const term = els.searchInput.value.toLowerCase().trim();
                         filteredData = fullData.filter(item => item.en.toLowerCase().includes(term) || item.vi.toLowerCase().includes(term));
                    } else {
                        filteredData = [...fullData];
                    }
                    
                    if (currentIndex >= filteredData.length) currentIndex = Math.max(0, filteredData.length - 1);
                    renderCard();
                }
            } else {
                alert("Không thể xóa thẻ mặc định!");
            }
        });

        // Import/Export
        els.btnExport.addEventListener('click', () => {
            const personal = localStorage.getItem('my_flashcards') || "[]";
            const mastered = localStorage.getItem('my_mastered_list') || "[]";
            const exportData = { cards: JSON.parse(personal), mastered: JSON.parse(mastered) };
            const dataStr = JSON.stringify(exportData);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', 'mesbox_backup.json');
            linkElement.click();
        });

        els.btnImport.addEventListener('click', () => els.fileImport.click());
        els.fileImport.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (event) => {
                try {
                    const imported = JSON.parse(event.target.result);
                    let newCards = [];
                    let newMastered = [];
                    if (Array.isArray(imported)) {
                        newCards = imported; 
                    } else if (imported.cards) {
                        newCards = imported.cards;
                        newMastered = imported.mastered || [];
                    }

                    const storedCards = JSON.parse(localStorage.getItem('my_flashcards') || "[]");
                    let countAdded = 0;
                    newCards.forEach(c => {
                        if (!storedCards.some(old => old.en.toLowerCase() === c.en.toLowerCase())) {
                            storedCards.unshift(c);
                            countAdded++;
                        }
                    });
                    localStorage.setItem('my_flashcards', JSON.stringify(storedCards));

                    const storedMastered = JSON.parse(localStorage.getItem('my_mastered_list') || "[]");
                    newMastered.forEach(m => {
                        if (!storedMastered.includes(m)) storedMastered.push(m);
                    });
                    localStorage.setItem('my_mastered_list', JSON.stringify(storedMastered));

                    fullData = loadData();
                    filteredData = [...fullData];
                    renderCard();
                    alert(`Đã nhập: ${countAdded} từ mới.`);
                } catch (err) { alert("File lỗi!"); }
            };
            reader.readAsText(file);
            e.target.value = '';
        });

        // Search & Inputs
        els.searchInput.addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase().trim();
            filteredData = fullData.filter(item => item.en.toLowerCase().includes(term) || item.vi.toLowerCase().includes(term));
            currentIndex = 0;
            isFlipped = false;
            els.cardInner.classList.remove('card-flipped');
            renderCard();
        });

        // Interactions
        els.flashcardArea.addEventListener('click', flipCard);
        els.btnNext.addEventListener('click', nextCard);
        els.btnPrev.addEventListener('click', prevCard);
        els.btnSpeakFront.addEventListener('click', (e) => { e.stopPropagation(); speak(filteredData[currentIndex].en); });
        els.btnSpeakBack.addEventListener('click', (e) => { e.stopPropagation(); speak(filteredData[currentIndex].en); });

        // Swipe
        let touchStartX = 0; let touchStartY = 0; const minSwipeDistance = 50;
        document.addEventListener('touchstart', (e) => {
            if (e.target.closest('#add-modal')) return;
            touchStartX = e.changedTouches[0].screenX; touchStartY = e.changedTouches[0].screenY;
        }, { passive: true });
        
        document.addEventListener('touchend', (e) => {
            if (e.target.closest('#add-modal')) return;
            const dX = touchStartX - e.changedTouches[0].screenX;
            const dY = touchStartY - e.changedTouches[0].screenY;
            if (Math.abs(dX) > Math.abs(dY) && Math.abs(dX) > minSwipeDistance) {
                dX > 0 ? nextCard() : prevCard();
            }
        }, { passive: true });

        // Keyboard
        window.addEventListener('keydown', (e) => {
            if (document.activeElement === els.searchInput || !els.addModal.classList.contains('hidden')) return;
            if (e.key === 'ArrowRight') nextCard();
            if (e.key === 'ArrowLeft') prevCard();
            if (e.key === ' ' || e.key === 'Enter') { e.preventDefault(); flipCard(); }
        });

        // PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => navigator.serviceWorker.register('./sw.js'));
        }

        // Start
        renderCard();
    </script>
</body>
</html>
