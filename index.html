<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flashcards Pro</title> 
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#111827">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3405/3405802.png">

    <style>
        body {
            background-color: #111827;
            color: #e5e5e5;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        .card-container { transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
        .card-flipped { transform: rotateY(180deg); }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1f2937; }
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; }
        
        /* Hi·ªáu ·ª©ng Active cho Tab */
        .tab-active {
            background-color: #2563eb;
            color: white;
            border-color: #3b82f6;
        }
        .tab-inactive {
            background-color: #1f2937;
            color: #9ca3af;
            border-color: #374151;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4 bg-gray-900 overflow-hidden relative">

    <div class="fixed top-4 left-4 z-50 flex gap-2">
        <button id="btn-export" class="w-10 h-10 bg-blue-900/50 hover:bg-blue-700 border border-blue-700 rounded-full text-blue-200 shadow-lg flex items-center justify-center transition active:scale-95" title="Xu·∫•t d·ªØ li·ªáu (Backup)">
            <i class="fas fa-file-export"></i>
        </button>
        <button id="btn-import" class="w-10 h-10 bg-purple-900/50 hover:bg-purple-700 border border-purple-700 rounded-full text-purple-200 shadow-lg flex items-center justify-center transition active:scale-95" title="Nh·∫≠p d·ªØ li·ªáu (Restore)">
            <i class="fas fa-file-import"></i>
        </button>
        <input type="file" id="file-import" class="hidden" accept=".json">
    </div>

    <button id="btn-add-modal" class="fixed bottom-6 right-6 w-14 h-14 bg-green-600 hover:bg-green-500 rounded-full text-white shadow-2xl z-50 flex items-center justify-center transition-transform active:scale-90 border-2 border-green-400">
        <i class="fas fa-plus text-2xl"></i>
    </button>

    <div id="add-modal" class="hidden fixed inset-0 bg-black/80 z-[60] flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-gray-800 rounded-2xl w-full max-w-sm p-6 border border-gray-700 shadow-2xl relative">
            <h3 class="text-xl font-bold text-white mb-4">Th√™m Flashcard m·ªõi</h3>
            <div class="mb-4">
                <label class="block text-gray-400 text-sm mb-1">Ti·∫øng Anh (Word)</label>
                <input id="input-en" type="text" class="w-full bg-gray-900 border border-gray-600 rounded-lg p-3 text-white focus:border-green-500 outline-none" placeholder="V√≠ d·ª•: apple">
            </div>
            <div class="mb-6">
                <label class="block text-gray-400 text-sm mb-1">Nghƒ©a Ti·∫øng Vi·ªát</label>
                <input id="input-vi" type="text" class="w-full bg-gray-900 border border-gray-600 rounded-lg p-3 text-white focus:border-green-500 outline-none" placeholder="V√≠ d·ª•: qu·∫£ t√°o">
            </div>
            <div class="flex gap-3">
                <button id="btn-cancel" class="flex-1 py-3 bg-gray-700 hover:bg-gray-600 rounded-lg text-gray-300 font-medium">H·ªßy</button>
                <button id="btn-save" class="flex-1 py-3 bg-green-600 hover:bg-green-500 rounded-lg text-white font-bold shadow-lg flex justify-center items-center gap-2">
                    <span>L∆∞u</span>
                    <i id="spinner" class="fas fa-spinner fa-spin hidden"></i>
                </button>
            </div>
        </div>
    </div>

    <div class="w-full max-w-md mb-4 z-10 flex flex-col gap-4">
        
        <div class="flex justify-between items-end px-1">
            <div>
                <h1 class="text-2xl font-bold text-blue-400 tracking-tight">My <span class="text-white">Flashcards</span></h1>
                <p id="mode-label" class="text-xs text-green-400 font-bold uppercase tracking-widest mt-1">ƒêang h·ªçc</p>
            </div>
            <div id="index-display" class="text-right text-sm font-mono text-gray-300 bg-gray-800 px-3 py-1 rounded-full border border-gray-700">
                0 / 0
            </div>
        </div>

        <div class="flex p-1 bg-gray-800 rounded-xl border border-gray-700">
            <button id="tab-learning" class="flex-1 py-2 rounded-lg text-sm font-bold transition-all tab-active border shadow-sm">
                ƒêang h·ªçc <span id="count-learning" class="ml-1 text-xs opacity-70">(0)</span>
            </button>
            <button id="tab-mastered" class="flex-1 py-2 rounded-lg text-sm font-bold transition-all tab-inactive border border-transparent hover:bg-gray-700">
                ƒê√£ thu·ªôc <span id="count-mastered" class="ml-1 text-xs opacity-70">(0)</span>
            </button>
        </div>

        <input id="search-input" type="text" placeholder="üîç T√¨m t·ª´ v·ª±ng..." class="p-3 w-full bg-gray-800 rounded-lg text-white border border-gray-700 focus:border-blue-500 outline-none transition duration-200" />
    </div>

    <div id="flashcard-area" class="relative w-full max-w-md h-80 cursor-pointer perspective-1000 group z-10">
        
        <button id="btn-delete" class="absolute -top-10 right-0 w-8 h-8 text-gray-500 hover:text-red-500 transition z-50 flex items-center justify-center" title="X√≥a th·∫ª n√†y">
            <i class="fas fa-trash-alt text-lg"></i>
        </button>

        <button id="btn-toggle-master" class="absolute -top-10 left-0 w-auto px-3 h-8 text-gray-400 hover:text-green-400 transition z-50 flex items-center justify-center gap-2 font-bold text-sm bg-gray-800/50 rounded-full border border-gray-700" title="ƒê√°nh d·∫•u tr·∫°ng th√°i">
            <i id="icon-master" class="far fa-check-circle text-lg"></i>
            <span id="text-master">ƒê√£ thu·ªôc?</span>
        </button>

        <div id="card-inner" class="relative w-full h-full duration-500 transform-style-3d card-container">
            <div class="absolute w-full h-full bg-gradient-to-br from-gray-800 to-gray-900 rounded-2xl shadow-2xl border-2 border-blue-500/50 p-8 flex flex-col items-center justify-center backface-hidden">
                <span class="absolute top-4 left-4 text-xs font-bold text-blue-400 tracking-widest bg-blue-500/10 px-2 py-1 rounded-md uppercase">English</span>
                <div class="flex-1 flex items-center justify-center w-full">
                    <h2 id="card-front-text" class="text-4xl md:text-5xl font-extrabold text-white text-center leading-tight break-words max-w-full">...</h2>
                </div>
                <button id="btn-speak-front" class="mt-4 w-12 h-12 rounded-full bg-blue-600 hover:bg-blue-500 flex items-center justify-center transition-all shadow-xl hover:shadow-blue-500/50 active:scale-95">
                    <i class="fas fa-volume-high text-white text-lg"></i>
                </button>
                <p class="mt-4 text-gray-500 text-xs flex items-center gap-2">
                    <i class="fas fa-hand-pointer"></i> Tap to Flip
                </p>
            </div>
            <div class="absolute w-full h-full bg-white rounded-2xl shadow-2xl p-8 flex flex-col items-center justify-center backface-hidden rotate-y-180 border-2 border-gray-300">
                <span class="absolute top-4 left-4 text-xs font-bold text-gray-600 tracking-widest uppercase border border-gray-300 px-2 py-1 rounded-md">Meaning</span>
                <div class="flex-1 flex flex-col items-center justify-center w-full space-y-4">
                    <h3 id="card-back-vi" class="text-3xl font-bold text-gray-900 text-center">...</h3>
                    <div class="px-4 py-2 bg-blue-50 rounded-lg border border-blue-100 shadow-inner">
                        <p id="card-back-ipa" class="text-xl text-blue-600 font-mono font-medium tracking-wide">...</p>
                    </div>
                    <p id="card-back-en" class="text-sm text-gray-400 font-semibold border-t border-gray-100 pt-2">...</p>
                </div>
                <button id="btn-speak-back" class="mb-2 w-10 h-10 rounded-full bg-gray-100 hover:bg-gray-200 text-gray-600 flex items-center justify-center transition-all">
                    <i class="fas fa-volume-high"></i>
                </button>
            </div>
        </div>
    </div>

    <div id="no-results" class="hidden text-center text-gray-400 text-xl mt-10 z-20">Danh s√°ch tr·ªëng.</div>

    <div class="w-full max-w-md flex justify-between items-center mt-8 z-10 px-4">
        <button id="btn-prev" class="w-14 h-14 rounded-full bg-gray-800 border border-gray-700 text-gray-300 hover:text-white hover:border-gray-500 hover:bg-blue-800 transition flex items-center justify-center active:scale-95 shadow-lg">
            <i class="fas fa-arrow-left text-lg"></i>
        </button>
        <div class="text-xs text-gray-500 font-mono flex flex-col items-center">
            <span>‚Üê Prev | Flip | Next ‚Üí</span>
        </div>
        <button id="btn-next" class="w-14 h-14 rounded-full bg-gray-800 border border-gray-700 text-gray-300 hover:text-white hover:border-gray-500 hover:bg-blue-800 transition flex items-center justify-center active:scale-95 shadow-lg">
            <i class="fas fa-arrow-right text-lg"></i>
        </button>
    </div>

    <script>
        // --- 1. DATA G·ªêC (DEFAULT) ---
        const defaultData = [
            { en: "feeding", vi: "cho ƒÉn", ipa: "/ÀàfiÀêd…™≈ã/" },
            { en: "nursing", vi: "chƒÉm s√≥c m·∫π/b√©", ipa: "/Ààn…úÀêrs…™≈ã/" },
            { en: "breastfeeding", vi: "cho b√∫ m·∫π", ipa: "/Ààbr…õstÀåfiÀêd…™≈ã/" },
            { en: "formula", vi: "s·ªØa c√¥ng th·ª©c", ipa: "/Ààf…îÀêrmj…ôl…ô/" },
            { en: "burp", vi: "v·ªó ·ª£", ipa: "/b…úÀêrp/" },
            { en: "crib", vi: "c≈©i", ipa: "/kr…™b/" },
            { en: "pacifier", vi: "ti gi·∫£", ipa: "/Ààp√¶s…™fa…™…ôr/" },
            { en: "swaddle", vi: "qu·∫•n khƒÉn", ipa: "/Ààsw…ëÀêd…ôl/" },
            { en: "wipe", vi: "khƒÉn ∆∞·ªõt", ipa: "/wa…™p/" },
            { en: "nap", vi: "ng·ªß ng·∫Øn", ipa: "/n√¶p/" },
            { en: "lullaby", vi: "ru ng·ªß", ipa: "/Ààl ål…ôba…™/" },
            { en: "cradle", vi: "c√°i n√¥i", ipa: "/Ààkre…™d…ôl/" },
            { en: "calm", vi: "tr·∫•n an", ipa: "/k…ëÀêm/" },
            { en: "cry", vi: "kh√≥c", ipa: "/kra…™/" },
            { en: "smile", vi: "c∆∞·ªùi", ipa: "/sma…™l/" },
            { en: "sneeze", vi: "h·∫Øt h∆°i", ipa: "/sniÀêz/" },
            { en: "cough", vi: "ho", ipa: "/k…îÀêf/" },
            { en: "fever", vi: "s·ªët", ipa: "/ÀàfiÀêv…ôr/" },
            { en: "medicine", vi: "thu·ªëc", ipa: "/Ààm…õd…ôs…ôn/" },
            { en: "doctor", vi: "b√°c sƒ©", ipa: "/Ààd…ëÀêkt…ôr/" },
            { en: "midwife", vi: "n·ªØ h·ªô sinh", ipa: "/Ààm…™dÀåwa…™f/" },
            { en: "clinic", vi: "ph√≤ng kh√°m", ipa: "/Ààkl…™n…™k/" },
            { en: "appointment", vi: "l·ªãch h·∫πn", ipa: "/…ôÀàp…î…™ntm…ônt/" },
            { en: "check-up", vi: "kh√°m ƒë·ªãnh k·ª≥", ipa: "/Ààt É…õkÀå åp/" },
            { en: "stroller walk", vi: "ƒë·∫©y xe ƒëi d·∫°o", ipa: "/Ààstro äl…ôr w…îÀêk/" },
            { en: "fresh air", vi: "kh√¥ng kh√≠ trong l√†nh", ipa: "/fr…õ É …õr/" },
            { en: "park", vi: "c√¥ng vi√™n", ipa: "/p…ëÀêrk/" },
            { en: "outside", vi: "b√™n ngo√†i", ipa: "/Ààa ätsa…™d/" },
            { en: "inside", vi: "b√™n trong", ipa: "/…™nÀàsa…™d/" },
            { en: "grocery", vi: "c·ª≠a h√†ng th·ª±c ph·∫©m", ipa: "/Àà…°ro äs…ôri/" },
            { en: "supermarket", vi: "si√™u th·ªã", ipa: "/ÀàsuÀêp…ôrÀåm…ëÀêrk…™t/" },
            { en: "shopping list", vi: "danh s√°ch mua", ipa: "/Àà É…ëÀêp…™≈ã l…™st/" },
            { en: "detergent", vi: "n∆∞·ªõc gi·∫∑t", ipa: "/d…™Ààt…úÀêrd í…ônt/" },
            { en: "softener", vi: "n∆∞·ªõc x·∫£", ipa: "/Ààs…îÀêf…ôn…ôr/" },
            { en: "laundry", vi: "gi·∫∑t gi≈©", ipa: "/Ààl…îÀêndri/" },
            { en: "dry", vi: "ph∆°i, s·∫•y", ipa: "/dra…™/" },
            { en: "fold", vi: "g·∫•p", ipa: "/fo äld/" },
            { en: "iron", vi: "·ªßi", ipa: "/Ààa…™…ôrn/" },
            { en: "trash", vi: "r√°c", ipa: "/tr√¶ É/" },
            { en: "bin", vi: "th√πng r√°c", ipa: "/b…™n/" },
            { en: "wipe down", vi: "lau s·∫°ch", ipa: "/wa…™p da än/" },
            { en: "mop", vi: "lau s√†n", ipa: "/m…ëÀêp/" },
            { en: "sweep", vi: "qu√©t", ipa: "/swiÀêp/" },
            { en: "tidy", vi: "ngƒÉn n·∫Øp", ipa: "/Ààta…™di/" },
            { en: "organize", vi: "s·∫Øp x·∫øp", ipa: "/Àà…îÀêr…°…ôna…™z/" },
            { en: "fridge", vi: "t·ªß l·∫°nh", ipa: "/fr…™d í/" },
            { en: "freezer", vi: "ngƒÉn ƒë√°", ipa: "/ÀàfriÀêz…ôr/" },
            { en: "stove", vi: "b·∫øp l√≤", ipa: "/sto äv/" },
            { en: "oven", vi: "l√≤ n∆∞·ªõng", ipa: "/Àà åv…ôn/" },
            { en: "microwave", vi: "l√≤ vi s√≥ng", ipa: "/Ààma…™kr…ôÀåwe…™v/" },
            { en: "sink", vi: "b·ªìn r·ª≠a", ipa: "/s…™≈ãk/" },
            { en: "tap", vi: "v√≤i n∆∞·ªõc", ipa: "/t√¶p/" },
            { en: "towel", vi: "khƒÉn", ipa: "/Ààta ä…ôl/" },
            { en: "tissue", vi: "khƒÉn gi·∫•y", ipa: "/Ààt…™ ÉuÀê/" },
            { en: "blanket cover", vi: "v·ªè chƒÉn", ipa: "/Ààbl√¶≈ãk…™t Ààk åv…ôr/" },
            { en: "sheet", vi: "ga gi∆∞·ªùng", ipa: "/ ÉiÀêt/" },
            { en: "mattress", vi: "n·ªám", ipa: "/Ààm√¶tr…ôs/" },
            { en: "heater", vi: "m√°y s∆∞·ªüi", ipa: "/ÀàhiÀêt…ôr/" },
            { en: "shower", vi: "v√≤i t·∫Øm", ipa: "/Àà Éa ä…ôr/" },
            { en: "shampoo", vi: "d·∫ßu g·ªôi", ipa: "/ É√¶mÀàpuÀê/" },
            { en: "soap", vi: "x√† ph√≤ng", ipa: "/so äp/" },
            { en: "cream", vi: "kem", ipa: "/kriÀêm/" },
            { en: "lotion", vi: "kem d∆∞·ª°ng", ipa: "/Ààlo ä É…ôn/" },
            { en: "sanitizer", vi: "dung d·ªãch s√°t khu·∫©n", ipa: "/Ààs√¶n…™ta…™z…ôr/" },
            { en: "allergy", vi: "d·ªã ·ª©ng", ipa: "/Àà√¶l…ôrd íi/" },
            { en: "schedule", vi: "l·ªãch", ipa: "/Ààsk…õd íuÀêl/" },
            { en: "routine", vi: "th√≥i quen h√†ng ng√†y", ipa: "/ruÀêÀàtiÀên/" },
            { en: "quiet", vi: "y√™n tƒ©nh", ipa: "/Ààkwa…™…ôt/" },
            { en: "noise", vi: "ti·∫øng ·ªìn", ipa: "/n…î…™z/" },
            { en: "gentle", vi: "nh·∫π nh√†ng", ipa: "/Ààd í…õnt…ôl/" },
            { en: "strong", vi: "m·∫°nh", ipa: "/str…îÀê≈ã/" },
            { en: "careful", vi: "c·∫©n th·∫≠n", ipa: "/Ààk…õrf…ôl/" },
            { en: "support", vi: "ƒë·ª°, h·ªó tr·ª£", ipa: "/s…ôÀàp…îÀêrt/" },
            { en: "lift", vi: "n√¢ng", ipa: "/l…™ft/" },
            { en: "drop", vi: "l√†m r∆°i", ipa: "/dr…ëÀêp/" },
            { en: "spill", vi: "l√†m ƒë·ªï", ipa: "/sp…™l/" },
            { en: "warm up", vi: "h√¢m n√≥ng", ipa: "/w…îÀêrm  åp/" },
            { en: "cool down", vi: "ƒë·ªÉ ngu·ªôi", ipa: "/kuÀêl da än/" },
            { en: "measure", vi: "ƒëo", ipa: "/Ààm…õ í…ôr/" },
            { en: "mix", vi: "tr·ªôn", ipa: "/m…™ks/" },
            { en: "shake", vi: "l·∫Øc", ipa: "/ Ée…™k/" },
            { en: "check", vi: "ki·ªÉm tra", ipa: "/t É…õk/" },
            { en: "temperature", vi: "nhi·ªát ƒë·ªô", ipa: "/Ààt…õmpr…ôt É…ôr/" },
            { en: "soft", vi: "m·ªÅm", ipa: "/s…îÀêft/" },
            { en: "hard", vi: "c·ª©ng", ipa: "/h…ëÀêrd/" },
            { en: "heavy", vi: "n·∫∑ng", ipa: "/Ààh…õvi/" },
            { en: "light-weight", vi: "nh·∫π", ipa: "/Ààla…™t we…™t/" },
            { en: "borrow", vi: "m∆∞·ª£n", ipa: "/Ààb…ëÀêro ä/" },
            { en: "return", vi: "tr·∫£", ipa: "/r…™Ààt…úÀêrn/" },
            { en: "visit", vi: "thƒÉm", ipa: "/Ààv…™z…™t/" },
            { en: "neighbor", vi: "h√†ng x√≥m", ipa: "/Ààne…™b…ôr/" },
            { en: "welcome", vi: "ch√†o ƒë√≥n", ipa: "/Ààw…õlk…ôm/" },
            { en: "stay", vi: "·ªü l·∫°i", ipa: "/ste…™/" },
            { en: "leave", vi: "r·ªùi ƒëi", ipa: "/liÀêv/" },
            { en: "come", vi: "ƒë·∫øn", ipa: "/k åm/" },
            { en: "go", vi: "ƒëi", ipa: "/…°o ä/" },
            { en: "bring back", vi: "mang v·ªÅ", ipa: "/br…™≈ã b√¶k/" },
            { en: "downstairs", vi: "t·∫ßng d∆∞·ªõi", ipa: "/Àåda änÀàst…õ…ôrz/" },
            { en: "upstairs", vi: "t·∫ßng tr√™n", ipa: "/Àå åpÀàst…õ…ôrz/" },
            { en: "hallway", vi: "h√†nh lang", ipa: "/Ààh…îÀêlwe…™/" },
            { en: "entrance", vi: "l·ªëi v√†o", ipa: "/Àà…õntr…ôns/" },
            { en: "backyard", vi: "s√¢n sau", ipa: "/Ààb√¶kÀåj…ëÀêrd/" },
            { en: "balcony", vi: "ban c√¥ng", ipa: "/Ààb√¶lk…ôni/" },
            { en: "wardrobe", vi: "t·ªß qu·∫ßn √°o", ipa: "/Ààw…îÀêrdro äb/" },
            { en: "drawer", vi: "ngƒÉn k√©o", ipa: "/dr…îÀêr/" },
            { en: "cupboard", vi: "t·ªß b·∫øp", ipa: "/Ààk åb…ôrd/" },
            { en: "kettle", vi: "·∫•m ƒëun n∆∞·ªõc", ipa: "/Ààk…õt…ôl/" },
            { en: "pot", vi: "n·ªìi", ipa: "/p…ít/" },
            { en: "pan", vi: "ch·∫£o", ipa: "/p√¶n/" },
            { en: "lid", vi: "n·∫Øp", ipa: "/l…™d/" },
            { en: "plate", vi: "ƒëƒ©a", ipa: "/ple…™t/" },
            { en: "bowl", vi: "t√¥", ipa: "/bo äl/" },
            { en: "fork", vi: "nƒ©a", ipa: "/f…îÀêrk/" },
            { en: "spoon", vi: "th√¨a", ipa: "/spuÀên/" },
            { en: "knife", vi: "dao", ipa: "/na…™f/" },
            { en: "chop", vi: "ch·∫∑t, th√°i", ipa: "/t É…íp/" },
            { en: "boil", vi: "lu·ªôc", ipa: "/b…î…™l/" },
            { en: "steam", vi: "h·∫•p", ipa: "/stiÀêm/" },
            { en: "fry", vi: "chi√™n", ipa: "/fra…™/" },
            { en: "grill", vi: "n∆∞·ªõng", ipa: "/…°r…™l/" },
            { en: "pour", vi: "r√≥t", ipa: "/p…îÀêr/" },
            { en: "stir", vi: "khu·∫•y", ipa: "/st…úÀêr/" },
            { en: "taste", vi: "n·∫øm", ipa: "/te…™st/" },
            { en: "salty", vi: "m·∫∑n", ipa: "/Ààs…îÀêlti/" },
            { en: "sweet", vi: "ng·ªçt", ipa: "/swiÀêt/" },
            { en: "sour", vi: "chua", ipa: "/Ààsa ä…ôr/" },
            { en: "bitter", vi: "ƒë·∫Øng", ipa: "/Ààb…™t…ôr/" },
            { en: "fresh", vi: "t∆∞∆°i", ipa: "/fr…õ É/" },
            { en: "frozen", vi: "ƒë√¥ng l·∫°nh", ipa: "/Ààfro äz…ôn/" },
            { en: "expired", vi: "h·∫øt h·∫°n", ipa: "/…™kÀàspa…™…ôrd/" },
            { en: "prepare", vi: "chu·∫©n b·ªã", ipa: "/pr…™Ààp…õ…ôr/" },
            { en: "serve", vi: "d·ªçn m√≥n", ipa: "/s…úÀêrv/" },
            { en: "leftovers", vi: "ƒë·ªì ƒÉn th·ª´a", ipa: "/Ààl…õftÀåo äv…ôrz/" },
            { en: "container", vi: "h·ªôp ƒë·ª±ng", ipa: "/k…ônÀàte…™n…ôr/" },
            { en: "label", vi: "d√°n nh√£n", ipa: "/Ààle…™b…ôl/" },
            { en: "fridge door", vi: "c·ª≠a t·ªß l·∫°nh", ipa: "/fr…™d í d…îÀêr/" },
            { en: "pantry", vi: "t·ªß ƒë·ªì kh√¥", ipa: "/Ààp√¶ntri/" },
            { en: "snack", vi: "ƒë·ªì ƒÉn nh·∫π", ipa: "/sn√¶k/" },
            { en: "spices", vi: "gia v·ªã", ipa: "/Ààspa…™s…™z/" },
            { en: "garlic", vi: "t·ªèi", ipa: "/Àà…°…ëÀêrl…™k/" },
            { en: "ginger", vi: "g·ª´ng", ipa: "/Ààd í…™nd í…ôr/" },
            { en: "onion", vi: "h√†nh t√¢y", ipa: "/Àà ånj…ôn/" },
            { en: "carrot", vi: "c√† r·ªët", ipa: "/Ààk√¶r…ôt/" },
            { en: "potato", vi: "khoai t√¢y", ipa: "/p…ôÀàte…™to ä/" },
            { en: "egg", vi: "tr·ª©ng", ipa: "/…õ…°/" },
            { en: "rice", vi: "c∆°m", ipa: "/ra…™s/" },
            { en: "noodle", vi: "m√¨", ipa: "/ÀànuÀêd…ôl/" },
            { en: "porridge", vi: "ch√°o", ipa: "/Ààp…îÀêr…™d í/" },
            { en: "bath", vi: "t·∫Øm", ipa: "/b√¶Œ∏/" },
            { en: "bathtub", vi: "b·ªìn t·∫Øm", ipa: "/Ààb√¶Œ∏Àåt åb/" },
            { en: "warm water", vi: "n∆∞·ªõc ·∫•m", ipa: "/w…îÀêrm Ààw…îÀêt…ôr/" },
            { en: "towel dry", vi: "lau kh√¥", ipa: "/Ààta ä…ôl dra…™/" },
            { en: "brush", vi: "ch·∫£i", ipa: "/br å É/" },
            { en: "comb", vi: "l∆∞·ª£c", ipa: "/ko äm/" },
            { en: "hair dryer", vi: "m√°y s·∫•y t√≥c", ipa: "/Ààh…õr Àådra…™…ôr/" },
            { en: "pajamas", vi: "ƒë·ªì ng·ªß", ipa: "/p…ôÀàd í√¶m…ôz/" },
            { en: "socks", vi: "v·ªõ", ipa: "/s…ëÀêks/" },
            { en: "gloves", vi: "gƒÉng tay", ipa: "/…°l åvz/" },
            { en: "hat", vi: "m≈©", ipa: "/h√¶t/" },
            { en: "jacket", vi: "√°o kho√°c", ipa: "/Ààd í√¶k…™t/" },
            { en: "blanket wrap", vi: "qu·∫•n chƒÉn", ipa: "/Ààbl√¶≈ãk…™t r√¶p/" },
            { en: "protect", vi: "b·∫£o v·ªá", ipa: "/pr…ôÀàt…õkt/" },
            { en: "comfort", vi: "d·ªó d√†nh", ipa: "/Ààk åmf…ôrt/" },
            { en: "cuddle", vi: "√¥m nh·∫π", ipa: "/Ààk åd…ôl/" },
            { en: "hold", vi: "b·∫ø", ipa: "/ho äld/" },
            { en: "lay down", vi: "ƒë·∫∑t n·∫±m", ipa: "/le…™ da än/" },
            { en: "pick up", vi: "b·∫ø l√™n", ipa: "/p…™k  åp/" },
            { en: "bedtime", vi: "gi·ªù ng·ªß", ipa: "/Ààb…õdta…™m/" },
            { en: "morning", vi: "bu·ªïi s√°ng", ipa: "/Ààm…îÀêrn…™≈ã/" },
            { en: "evening", vi: "bu·ªïi t·ªëi", ipa: "/ÀàiÀêvn…™≈ã/" },
            { en: "midnight", vi: "n·ª≠a ƒë√™m", ipa: "/Ààm…™dna…™t/" },
            { en: "early", vi: "s·ªõm", ipa: "/Àà…úÀêrli/" },
            { en: "late", vi: "mu·ªôn", ipa: "/le…™t/" },
            { en: "arrive", vi: "ƒë·∫øn n∆°i", ipa: "/…ôÀàra…™v/" },
            { en: "depart", vi: "kh·ªüi h√†nh", ipa: "/d…™Ààp…ëÀêrt/" },
            { en: "boarding", vi: "l√™n m√°y bay", ipa: "/Ààb…îÀêrd…™≈ã/" },
            { en: "check-in", vi: "l√†m th·ªß t·ª•c", ipa: "/Ààt É…õk …™n/" },
            { en: "passport", vi: "h·ªô chi·∫øu", ipa: "/Ààp√¶sp…îÀêrt/" },
            { en: "luggage", vi: "h√†nh l√Ω", ipa: "/Ààl å…°…™d í/" },
            { en: "suitcase", vi: "vali", ipa: "/ÀàsuÀêtke…™s/" },
            { en: "security check", vi: "ki·ªÉm tra an ninh", ipa: "/s…™Ààkj ä…ôr…ôti t É…õk/" },
            { en: "gate", vi: "c·ªïng", ipa: "/…°e…™t/" },
            { en: "seat", vi: "gh·∫ø", ipa: "/siÀêt/" },
            { en: "window seat", vi: "gh·∫ø g·∫ßn c·ª≠a s·ªï", ipa: "/Ààw…™ndo ä siÀêt/" },
            { en: "aisle seat", vi: "gh·∫ø l·ªëi ƒëi", ipa: "/a…™l siÀêt/" },
            { en: "flight attendant", vi: "ti·∫øp vi√™n", ipa: "/fla…™t …ôÀàt…õnd…ônt/" },
            { en: "water please", vi: "cho t√¥i n∆∞·ªõc", ipa: "/Ààw…îÀêt…ôr pliÀêz/" },
            { en: "help me", vi: "gi√∫p t√¥i", ipa: "/h…õlp miÀê/" },
            { en: "understand", vi: "hi·ªÉu", ipa: "/Àå ånd…ôrÀàst√¶nd/" },
            { en: "repeat", vi: "nh·∫Øc l·∫°i", ipa: "/r…™ÀàpiÀêt/" },
            { en: "slowly", vi: "ch·∫≠m", ipa: "/Ààslo äli/" },
            { en: "thank you", vi: "c·∫£m ∆°n", ipa: "/ÀàŒ∏√¶≈ãk juÀê/" },
            { en: "excuse me", vi: "xin l·ªói/l√†m ∆°n", ipa: "/…™kÀàskjuÀêz miÀê/" },
            { en: "shelf", vi: "k·ªá", ipa: "/ É…õlf/" },
            { en: "blanket", vi: "chƒÉn", ipa: "/Ààbl√¶≈ã.k…™t/" },
            { en: "pillow", vi: "g·ªëi", ipa: "/Ààp…™l.o ä/" },
            { en: "wet wipes", vi: "khƒÉn ∆∞·ªõt", ipa: "/w…õt wa…™ps/" },
            { en: "bottle warmer", vi: "m√°y h√¢m b√¨nh s·ªØa", ipa: "/Ààb…ít.…ôl Ààw…îÀêr.m…ôr/" },
            { en: "stroller", vi: "xe ƒë·∫©y", ipa: "/Ààstro ä.l…ôr/" },
            { en: "crib mattress", vi: "n·ªám c≈©i", ipa: "/kr…™b Ààm√¶t.r…ôs/" },
            { en: "babysitter", vi: "ng∆∞·ªùi tr√¥ng tr·∫ª", ipa: "/Ààbe…™.biÀås…™t.…ôr/" },
            { en: "laundry basket", vi: "gi·ªè ƒë·ª±ng ƒë·ªì gi·∫∑t", ipa: "/Ààl…îÀên.dri Ààb√¶s.k…™t/" },
            { en: "rinse", vi: "x·∫£", ipa: "/r…™ns/" },
            { en: "vacuum", vi: "h√∫t b·ª•i", ipa: "/Ààv√¶k.juÀêm/" },
            { en: "sanitize", vi: "kh·ª≠ khu·∫©n", ipa: "/Ààs√¶n.…™.ta…™z/" },
            { en: "disinfect", vi: "kh·ª≠ tr√πng", ipa: "/Àåd…™s.…™nÀàfekt/" },
            { en: "rash", vi: "ph√°t ban", ipa: "/r√¶ É/" },
            { en: "ointment", vi: "thu·ªëc m·ª°", ipa: "/Àà…î…™nt.m…ônt/" },
            { en: "fever patch", vi: "mi·∫øng h·∫° s·ªët", ipa: "/ÀàfiÀê.v…ôr p√¶t É/" },
            { en: "soothing", vi: "l√†m d·ªãu", ipa: "/ÀàsuÀê.√∞…™≈ã/" },
            { en: "babymonitor", vi: "m√°y theo d√µi tr·∫ª", ipa: "/Ààbe…™.biÀåm…ín.…™.t…ôr/" },
            { en: "diaper cream", vi: "kem ch·ªëng hƒÉm", ipa: "/Ààda…™.p…ôr kriÀêm/" },
            { en: "pacifier clip", vi: "d√¢y gi·ªØ ti gi·∫£", ipa: "/Ààp√¶s.…™.fa…™.…ôr kl…™p/" },
            { en: "bib", vi: "y·∫øm", ipa: "/b…™b/" },
            { en: "burp cloth", vi: "khƒÉn v·∫£i cho b√© ·ª£", ipa: "/b…úÀêrp kl…íŒ∏/" },
            { en: "meal prep", vi: "chu·∫©n b·ªã b·ªØa ƒÉn", ipa: "/ÀàmiÀêl prep/" },
            { en: "portion", vi: "kh·∫©u ph·∫ßn", ipa: "/Ààp…îÀêr. É…ôn/" },
            { en: "simmer", vi: "ninh nh·ªè l·ª≠a", ipa: "/Ààs…™m.…ôr/" },
            { en: "blend", vi: "xay", ipa: "/blend/" },
            { en: "puree", vi: "nghi·ªÅn nhuy·ªÖn", ipa: "/pj äÀàre…™/" },
            { en: "frying pan", vi: "ch·∫£o", ipa: "/Ààfra…™.…™≈ã p√¶n/" },
            { en: "chopping board", vi: "th·ªõt", ipa: "/Ààt É…íp.…™≈ã b…îÀêrd/" },
            { en: "apron", vi: "t·∫°p d·ªÅ", ipa: "/Ààe…™.pr…ôn/" },
            { en: "grocery list", vi: "danh s√°ch mua ƒë·ªì", ipa: "/Àà…°ro ä.s…ô.ri l…™st/" },
            { en: "receipt", vi: "h√≥a ƒë∆°n", ipa: "/r…™ÀàsiÀêt/" },
            { en: "refill", vi: "b·ªï sung", ipa: "/ÀàriÀê.f…™l/" },
            { en: "sponge", vi: "mi·∫øng r·ª≠a", ipa: "/sp ånd í/" },
            { en: "trash bag", vi: "t√∫i r√°c", ipa: "/tr√¶ É b√¶…°/" },
            { en: "garbage bin", vi: "th√πng r√°c", ipa: "/Àà…°…ëÀêr.b…™d í b…™n/" },
            { en: "recycle", vi: "t√°i ch·∫ø", ipa: "/riÀêÀàsa…™.k…ôl/" },
            { en: "insurance", vi: "b·∫£o hi·ªÉm", ipa: "/…™nÀà É är.…ôns/" },
            { en: "pharmacy", vi: "hi·ªáu thu·ªëc", ipa: "/Ààf…ëÀêr.m…ô.si/" },
            { en: "traffic", vi: "giao th√¥ng", ipa: "/Ààtr√¶f.…™k/" },
            { en: "roundabout", vi: "b√πng binh", ipa: "/Ààra änd.…ô.ba ät/" },
            { en: "subway", vi: "t√†u ƒëi·ªán ng·∫ßm", ipa: "/Ààs åb.we…™/" },
            { en: "platform", vi: "s√¢n ga", ipa: "/Ààpl√¶t.f…îÀêrm/" },
            { en: "ticket machine", vi: "m√°y b√°n v√©", ipa: "/Ààt…™k.…™t m…ôÀå ÉiÀên/" },
            { en: "fine", vi: "ph·∫°t", ipa: "/fa…™n/" },
            { en: "landlord", vi: "ch·ªß nh√†", ipa: "/Ààl√¶nd.l…îÀêrd/" },
            { en: "rent", vi: "ti·ªÅn thu√™ nh√†", ipa: "/rent/" },
            { en: "radiator", vi: "l√≤ s∆∞·ªüi n∆∞·ªõc", ipa: "/Ààre…™.di.e…™.t…ôr/" },
            { en: "curtain", vi: "r√®m", ipa: "/Ààk…úÀêr.t…ôn/" },
            { en: "keychain", vi: "m√≥c ch√¨a kh√≥a", ipa: "/ÀàkiÀê.t Ée…™n/" },
            { en: "mailbox", vi: "h·ªôp th∆∞", ipa: "/Ààme…™l.b…íks/" },
            { en: "delivery", vi: "giao h√†ng", ipa: "/d…™Ààl…™v.…ôr.i/" },
            { en: "signature", vi: "ch·ªØ k√Ω", ipa: "/Ààs…™…°.n…ô.t É…ôr/" },
            { en: "friendly", vi: "th√¢n thi·ªán", ipa: "/Ààfrend.li/" },
            { en: "polite", vi: "l·ªãch s·ª±", ipa: "/p…ôÀàla…™t/" },
            { en: "quiet hours", vi: "gi·ªù y√™n l·∫∑ng", ipa: "/Ààkwa…™.…ôt a ä…ôrz/" },
            { en: "recycling room", vi: "ph√≤ng ph√¢n lo·∫°i r√°c", ipa: "/riÀêÀàsa…™.kl…™≈ã ruÀêm/" },
            { en: "snow", vi: "tuy·∫øt", ipa: "/sno ä/" },
            { en: "slippery", vi: "tr∆°n", ipa: "/Ààsl…™p.…ôr.i/" },
            { en: "boots", vi: "gi√†y boots", ipa: "/buÀêts/" },
            { en: "basement", vi: "t·∫ßng h·∫ßm", ipa: "/Ààbe…™s.m…ônt/" },
            { en: "attic", vi: "g√°c m√°i", ipa: "/Àà√¶t.…™k/" },
            { en: "doorstep", vi: "b·∫≠c c·ª≠a", ipa: "/Ààd…îÀêr.step/" },
            { en: "intercom", vi: "chu√¥ng li√™n l·∫°c", ipa: "/Àà…™n.t…ôr.k…ím/" },
            { en: "security code", vi: "m√£ m·ªü c·ª≠a", ipa: "/s…™Ààkj är.…ô.ti ko äd/" },
            { en: "emergency", vi: "t√¨nh hu·ªëng kh·∫©n c·∫•p", ipa: "/…™Ààm…úÀêr.d í…ôn.si/" },
            { en: "ambulance", vi: "xe c·ª©u th∆∞∆°ng", ipa: "/Àà√¶m.bj ä.l…ôns/" },
            { en: "fire alarm", vi: "b√°o ch√°y", ipa: "/Ààfa…™…ôr …ôÀål…ëÀêrm/" },
            { en: "exit", vi: "l·ªëi ra", ipa: "/Ààe…°.z…™t/" },
            { en: "stairs", vi: "c·∫ßu thang", ipa: "/sterz/" },
            { en: "elevator", vi: "thang m√°y", ipa: "/Ààel.…ô.ve…™.t…ôr/" },
            { en: "railing", vi: "tay v·ªãn", ipa: "/Ààre…™.l…™≈ã/" },
            { en: "oven mitts", vi: "gƒÉng ch·ªëng n√≥ng", ipa: "/Àà åv.…ôn m…™ts/" },
            { en: "pressure cooker", vi: "n·ªìi √°p su·∫•t", ipa: "/Ààpre É.…ôr Ààk äk.…ôr/" },
            { en: "ladle", vi: "mu√¥i", ipa: "/Ààle…™.dl/" },
            { en: "spatula", vi: "c√°i x·∫ªng l·∫≠t", ipa: "/Ààsp√¶t É.…ô.l…ô/" },
            { en: "pot lid", vi: "n·∫Øp n·ªìi", ipa: "/p…ít l…™d/" },
            { en: "groceries", vi: "ƒë·ªì t·∫°p h√≥a", ipa: "/Àà…°ro ä.s…ôr.iz/" },
            { en: "butcher", vi: "c·ª≠a h√†ng th·ªãt", ipa: "/Ààb ät É.…ôr/" },
            { en: "bakery", vi: "ti·ªám b√°nh", ipa: "/Ààbe…™.k…ôr.i/" },
            { en: "dairy", vi: "ƒë·ªì t·ª´ s·ªØa", ipa: "/Ààder.i/" },
            { en: "expiration date", vi: "h·∫°n s·ª≠ d·ª•ng", ipa: "/Àåek.sp…ôÀàre…™. É…ôn de…™t/" },
            { en: "seasoning", vi: "gia v·ªã", ipa: "/ÀàsiÀê.z…ôn.…™≈ã/" },
            { en: "parsley", vi: "rau m√πi t√¢y", ipa: "/Ààp…ëÀêr.sli/" },
            { en: "mint", vi: "b·∫°c h√†", ipa: "/m…™nt/" },
            { en: "cinnamon", vi: "qu·∫ø", ipa: "/Ààs…™n.…ô.m…ôn/" },
            { en: "napkin", vi: "khƒÉn ƒÉn", ipa: "/Ààn√¶p.k…™n/" },
            { en: "dining table", vi: "b√†n ƒÉn", ipa: "/Ààda…™.n…™≈ã Àåte…™.b…ôl/" },
            { en: "sofa", vi: "gh·∫ø sofa", ipa: "/Ààso ä.f…ô/" },
            { en: "cushion", vi: "g·ªëi t·ª±a", ipa: "/Ààk ä É.…ôn/" },
            { en: "carpet", vi: "th·∫£m", ipa: "/Ààk…ëÀêr.p…™t/" },
            { en: "wardrobe hanger", vi: "m√≥c √°o", ipa: "/Ààh√¶≈ã.…ôr/" },
            { en: "laundry detergent pod", vi: "vi√™n gi·∫∑t", ipa: "/Ààl…îÀên.dri p…íd/" },
            { en: "ironing board", vi: "b√†n ·ªßi", ipa: "/Ààa…™…ô.r…™≈ã b…îÀêrd/" },
            { en: "wrinkle", vi: "nhƒÉn", ipa: "/Ààr…™≈ã.k…ôl/" },
            { en: "hang", vi: "treo", ipa: "/h√¶≈ã/" },
            { en: "grocery cart", vi: "xe ƒë·∫©y si√™u th·ªã", ipa: "/Àà…°ro ä.s…ô.ri k…ëÀêrt/" },
            { en: "aisle", vi: "l·ªëi ƒëi si√™u th·ªã", ipa: "/a…™l/" },
            { en: "barcode", vi: "m√£ v·∫°ch", ipa: "/Ààb…ëÀêr.ko äd/" },
            { en: "refund", vi: "ho√†n ti·ªÅn", ipa: "/ÀàriÀê.f ånd/" },
            { en: "exchange", vi: "ƒë·ªïi h√†ng", ipa: "/…™ksÀàt Ée…™nd í/" },
            { en: "fitting room", vi: "ph√≤ng th·ª≠ ƒë·ªì", ipa: "/Ààf…™t.…™≈ã ruÀêm/" },
            { en: "winter coat", vi: "√°o kho√°c m√πa ƒë√¥ng", ipa: "/Ààw…™n.t…ôr ko ät/" },
            { en: "scarf", vi: "khƒÉn cho√†ng", ipa: "/sk…ëÀêrf/" },
            { en: "thermal shirt", vi: "√°o gi·ªØ nhi·ªát", ipa: "/ÀàŒ∏…ùÀê.m…ôl  É…úÀêrt/" },
            { en: "indoor shoes", vi: "d√©p ƒëi trong nh√†", ipa: "/Àà…™n.d…îÀêr  ÉuÀêz/" },
            { en: "humidifier", vi: "m√°y t·∫°o ·∫©m", ipa: "/hjuÀêÀàm…™d.…ô.fa…™.…ôr/" },
            { en: "air purifier", vi: "m√°y l·ªçc kh√¥ng kh√≠", ipa: "/Ààer Àåpj är.…ô.fa…™.…ôr/" },
            { en: "thermostat", vi: "b·ªô ƒëi·ªÅu nhi·ªát", ipa: "/ÀàŒ∏…ùÀê.m…ô.st√¶t/" },
            { en: "fuse box", vi: "h·ªôp c·∫ßu ch√¨", ipa: "/fjuÀêz b…íks/" },
            { en: "power outlet", vi: "·ªï c·∫Øm", ipa: "/Ààpa ä.…ôr Àåa ät.l…™t/" },
            { en: "charger", vi: "b·ªô s·∫°c", ipa: "/Ààt É…ëÀêr.d í…ôr/" },
            { en: "screen", vi: "m√†n h√¨nh", ipa: "/skriÀên/" },
            { en: "Wi-Fi password", vi: "m·∫≠t kh·∫©u Wi-Fi", ipa: "/Ààwa…™.fa…™ Ààp√¶s.w…úÀêrd/" },
            { en: "connection", vi: "k·∫øt n·ªëi", ipa: "/k…ôÀànek. É…ôn/" },
            { en: "headset", vi: "tai nghe ch·ª•p", ipa: "/Ààhed.set/" },
            { en: "voicemail", vi: "h·ªôp th∆∞ tho·∫°i", ipa: "/Ààv…î…™s.me…™l/" },
            { en: "ringtone", vi: "nh·∫°c chu√¥ng", ipa: "/Ààr…™≈ã.to än/" },
            { en: "charging cable", vi: "d√¢y s·∫°c", ipa: "/Ààt É…ëÀêr.d í…™≈ã Àåke…™.b…ôl/" },
            { en: "appointment letter", vi: "gi·∫•y h·∫πn", ipa: "/…ôÀàp…î…™nt.m…ônt Ààlet.…ôr/" },
            { en: "registration", vi: "ƒëƒÉng k√Ω", ipa: "/Àåred í.…™Ààstre…™. É…ôn/" },
            { en: "stroller ramp", vi: "ƒë∆∞·ªùng d·ªëc cho xe ƒë·∫©y", ipa: "/Ààr√¶mp/" },
            { en: "baby carrier", vi: "ƒë·ªãu em b√©", ipa: "/Ààbe…™.bi Àåk√¶r.i.…ôr/" },
            { en: "teething toy", vi: "ƒë·ªì g·∫∑m n∆∞·ªõu", ipa: "/ÀàtiÀê.√∞…™≈ã t…î…™/" },
            { en: "newborn checkup", vi: "ki·ªÉm tra tr·∫ª s∆° sinh", ipa: "/Ààt Éek. åp/" },
            { en: "pediatrician", vi: "b√°c sƒ© nhi", ipa: "/ÀåpiÀê.di.…ôÀàtr…™ É.…ôn/" },
            { en: "symptoms", vi: "tri·ªáu ch·ª©ng", ipa: "/Ààs…™mp.t…ômz/" },
            { en: "appointment card", vi: "th·∫ª l·ªãch h·∫πn", ipa: "/…ôÀàp…î…™nt.m…ônt k…ëÀêrd/" },
            { en: "breastfeeding pillow", vi: "g·ªëi cho b√∫", ipa: "/ÀàbrestÀåfiÀêd…™≈ã Ààp…™l.o ä/" },
            { en: "nursing bra", vi: "√°o l√≥t cho m·∫π b·ªâm", ipa: "/Ààn…úÀê.s…™≈ã br…ëÀê/" },
            { en: "pumping", vi: "h√∫t s·ªØa", ipa: "/Ààp åmp.…™≈ã/" },
            { en: "milk storage bag", vi: "t√∫i tr·ªØ s·ªØa", ipa: "/st…îÀêr.…™d í b√¶…°/" },
            { en: "cradle cap", vi: "c·ª©t tr√¢u", ipa: "/Ààkre…™.dl k√¶p/" },
        ];

        // --- 2. LOGIC M·ªöI (CHUNG) ---
        
        let currentMode = 'learning'; // 'learning' ho·∫∑c 'mastered'

        // H√†m x√°o tr·ªôn (Random)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function loadData() {
            const storedPersonal = localStorage.getItem('my_flashcards');
            const personalData = storedPersonal ? JSON.parse(storedPersonal) : [];
            
            const storedMastered = localStorage.getItem('my_mastered_list');
            const masteredList = storedMastered ? JSON.parse(storedMastered) : [];

            // G·ªôp t·∫•t c·∫£
            const allData = [...personalData, ...defaultData];

            // ƒê·∫øm s·ªë l∆∞·ª£ng
            const masteredCount = allData.filter(item => masteredList.includes(item.en)).length;
            const learningCount = allData.length - masteredCount;

            document.getElementById('count-learning').textContent = `(${learningCount})`;
            document.getElementById('count-mastered').textContent = `(${masteredCount})`;

            // L·ªçc theo ch·∫ø ƒë·ªô
            let resultData = [];
            if (currentMode === 'learning') {
                resultData = allData.filter(item => !masteredList.includes(item.en));
            } else {
                resultData = allData.filter(item => masteredList.includes(item.en));
            }

            return shuffleArray(resultData);
        }

        // Init Data
        let fullData = loadData(); 
        let filteredData = [...fullData];
        let currentIndex = 0;
        let isFlipped = false;

        // --- DOM ELEMENTS ---
        const els = {
            cardInner: document.getElementById('card-inner'),
            frontText: document.getElementById('card-front-text'),
            backVi: document.getElementById('card-back-vi'),
            backIpa: document.getElementById('card-back-ipa'),
            backEn: document.getElementById('card-back-en'),
            counter: document.getElementById('counter-text'),
            indexDisplay: document.getElementById('index-display'),
            searchInput: document.getElementById('search-input'),
            btnPrev: document.getElementById('btn-prev'),
            btnNext: document.getElementById('btn-next'),
            btnSpeakFront: document.getElementById('btn-speak-front'),
            btnSpeakBack: document.getElementById('btn-speak-back'),
            flashcardArea: document.getElementById('flashcard-area'),
            noResults: document.getElementById('no-results'),
            addModal: document.getElementById('add-modal'),
            btnAddModal: document.getElementById('btn-add-modal'),
            btnCancel: document.getElementById('btn-cancel'),
            btnSave: document.getElementById('btn-save'),
            inputEn: document.getElementById('input-en'),
            inputVi: document.getElementById('input-vi'),
            spinner: document.getElementById('spinner'),
            btnDelete: document.getElementById('btn-delete'),
            btnExport: document.getElementById('btn-export'),
            btnImport: document.getElementById('btn-import'),
            fileImport: document.getElementById('file-import'),
            tabLearning: document.getElementById('tab-learning'),
            tabMastered: document.getElementById('tab-mastered'),
            btnToggleMaster: document.getElementById('btn-toggle-master'),
            iconMaster: document.getElementById('icon-master'),
            textMaster: document.getElementById('text-master')
        };

        // --- RENDER ---
        function renderCard() {
            if (filteredData.length === 0) {
                els.flashcardArea.style.display = 'none';
                els.noResults.classList.remove('hidden');
                els.noResults.textContent = currentMode === 'learning' ? "ƒê√£ thu·ªôc h·∫øt r·ªìi! Qua tab kia √¥n t·∫≠p ƒëi." : "Ch∆∞a c√≥ t·ª´ n√†o ƒë√£ thu·ªôc.";
                els.indexDisplay.textContent = "0 / 0";
                return;
            }

            els.flashcardArea.style.display = 'block';
            els.noResults.classList.add('hidden');

            const card = filteredData[currentIndex];
            els.frontText.textContent = card.en;
            els.backVi.textContent = card.vi;
            els.backIpa.textContent = card.ipa || "/.../"; 
            els.backEn.textContent = card.en;

            els.indexDisplay.textContent = `${currentIndex + 1} / ${filteredData.length}`;
            
            if (currentMode === 'learning') {
                els.iconMaster.className = "far fa-check-circle text-lg";
                els.textMaster.textContent = "ƒê√£ thu·ªôc?";
                els.btnToggleMaster.className = "absolute -top-10 left-0 w-auto px-3 h-8 text-gray-400 hover:text-green-400 transition z-50 flex items-center justify-center gap-2 font-bold text-sm bg-gray-800/50 rounded-full border border-gray-700";
            } else {
                els.iconMaster.className = "fas fa-times-circle text-lg";
                els.textMaster.textContent = "H·ªçc l·∫°i";
                els.btnToggleMaster.className = "absolute -top-10 left-0 w-auto px-3 h-8 text-gray-400 hover:text-yellow-400 transition z-50 flex items-center justify-center gap-2 font-bold text-sm bg-gray-800/50 rounded-full border border-gray-700";
            }

            els.btnPrev.disabled = filteredData.length <= 1;
            els.btnNext.disabled = filteredData.length <= 1;
            els.btnPrev.style.opacity = filteredData.length <= 1 ? "0.3" : "1";
            els.btnNext.style.opacity = filteredData.length <= 1 ? "0.3" : "1";
        }

        function flipCard() {
            isFlipped = !isFlipped;
            els.cardInner.classList.toggle('card-flipped', isFlipped);
        }

        function nextCard() {
            if (filteredData.length <= 1) return;
            isFlipped = false;
            els.cardInner.classList.remove('card-flipped');
            setTimeout(() => {
                currentIndex = (currentIndex + 1) % filteredData.length;
                renderCard();
            }, 150);
        }

        function prevCard() {
            if (filteredData.length <= 1) return;
            isFlipped = false;
            els.cardInner.classList.remove('card-flipped');
            setTimeout(() => {
                currentIndex = (currentIndex - 1 + filteredData.length) % filteredData.length;
                renderCard();
            }, 150);
        }

        function speak(text) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US';
                utterance.rate = 0.9;
                window.speechSynthesis.speak(utterance);
            }
        }

        // --- MODE SWITCHING ---
        function setMode(mode) {
            currentMode = mode;
            
            if (mode === 'learning') {
                els.tabLearning.className = "flex-1 py-2 rounded-lg text-sm font-bold transition-all tab-active border shadow-sm";
                els.tabMastered.className = "flex-1 py-2 rounded-lg text-sm font-bold transition-all tab-inactive border border-transparent hover:bg-gray-700";
            } else {
                els.tabLearning.className = "flex-1 py-2 rounded-lg text-sm font-bold transition-all tab-inactive border border-transparent hover:bg-gray-700";
                els.tabMastered.className = "flex-1 py-2 rounded-lg text-sm font-bold transition-all tab-active border shadow-sm";
            }

            fullData = loadData();
            filteredData = [...fullData];
            currentIndex = 0;
            isFlipped = false;
            els.cardInner.classList.remove('card-flipped');
            els.searchInput.value = ''; 
            renderCard();
        }

        els.tabLearning.addEventListener('click', () => setMode('learning'));
        els.tabMastered.addEventListener('click', () => setMode('mastered'));

        // --- TOGGLE MASTERED ---
        els.btnToggleMaster.addEventListener('click', (e) => {
            e.stopPropagation();
            const currentCard = filteredData[currentIndex];
            if (!currentCard) return;

            const storedMastered = localStorage.getItem('my_mastered_list');
            let masteredList = storedMastered ? JSON.parse(storedMastered) : [];

            if (currentMode === 'learning') {
                if (!masteredList.includes(currentCard.en)) {
                    masteredList.push(currentCard.en);
                    localStorage.setItem('my_mastered_list', JSON.stringify(masteredList));
                    
                    els.flashcardArea.classList.add('opacity-0', 'scale-95', 'transition-all');
                    setTimeout(() => {
                        fullData = loadData(); 
                        filteredData = [...fullData];
                        if (currentIndex >= filteredData.length) currentIndex = 0;
                        renderCard();
                        els.flashcardArea.classList.remove('opacity-0', 'scale-95');
                    }, 300);
                }
            } else {
                masteredList = masteredList.filter(word => word !== currentCard.en);
                localStorage.setItem('my_mastered_list', JSON.stringify(masteredList));
                
                els.flashcardArea.classList.add('opacity-0', 'scale-95', 'transition-all');
                setTimeout(() => {
                    fullData = loadData();
                    filteredData = [...fullData];
                    if (currentIndex >= filteredData.length) currentIndex = 0;
                    renderCard();
                    els.flashcardArea.classList.remove('opacity-0', 'scale-95');
                }, 300);
            }
        });

        // --- MODAL & ADD ---
        els.btnAddModal.addEventListener('click', () => {
            els.addModal.classList.remove('hidden');
            els.inputEn.focus();
        });
        
        els.btnCancel.addEventListener('click', () => {
            els.addModal.classList.add('hidden');
            els.inputEn.value = '';
            els.inputVi.value = '';
        });

        async function fetchIPA(word) {
            try {
                const res = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
                const data = await res.json();
                if (Array.isArray(data) && data.length > 0) {
                    return data[0].phonetic || (data[0].phonetics.find(p => p.text)?.text) || "";
                }
                return "";
            } catch (err) { return ""; }
        }

        els.btnSave.addEventListener('click', async () => {
            const en = els.inputEn.value.trim();
            const vi = els.inputVi.value.trim();
            if (!en || !vi) { alert("Thi·∫øu th√¥ng tin!"); return; }

            const stored = localStorage.getItem('my_flashcards');
            const personalData = stored ? JSON.parse(stored) : [];
            if (personalData.some(c => c.en.toLowerCase() === en.toLowerCase())) {
                if(!confirm("T·ª´ n√†y b·∫°n ƒë√£ th√™m r·ªìi. Th√™m n·ªØa kh√¥ng?")) return;
            }

            els.btnSave.disabled = true;
            els.spinner.classList.remove('hidden');

            let ipa = await fetchIPA(en);
            if (!ipa) ipa = "/.../"; 

            const newCard = { en, vi, ipa };
            personalData.unshift(newCard); 
            localStorage.setItem('my_flashcards', JSON.stringify(personalData));

            if (currentMode !== 'learning') setMode('learning');
            else {
                fullData = loadData();
                filteredData = [...fullData];
                const newIndex = filteredData.findIndex(item => item.en === en);
                currentIndex = newIndex !== -1 ? newIndex : 0;
                renderCard();
            }

            els.inputEn.value = ''; els.inputVi.value = '';
            els.addModal.classList.add('hidden');
            els.btnSave.disabled = false;
            els.spinner.classList.add('hidden');
        });

        // --- DELETE ---
        els.btnDelete.addEventListener('click', (e) => {
            e.stopPropagation(); 
            const currentCard = filteredData[currentIndex];
            const stored = localStorage.getItem('my_flashcards');
            let personalData = stored ? JSON.parse(stored) : [];
            const indexToDelete = personalData.findIndex(item => item.en === currentCard.en && item.vi === currentCard.vi);

            if (indexToDelete !== -1) {
                if (confirm(`X√≥a vƒ©nh vi·ªÖn "${currentCard.en}"?`)) {
                    personalData.splice(indexToDelete, 1);
                    localStorage.setItem('my_flashcards', JSON.stringify(personalData));
                    
                    const storedMastered = localStorage.getItem('my_mastered_list');
                    let masteredList = storedMastered ? JSON.parse(storedMastered) : [];
                    if (masteredList.includes(currentCard.en)) {
                        masteredList = masteredList.filter(w => w !== currentCard.en);
                        localStorage.setItem('my_mastered_list', JSON.stringify(masteredList));
                    }

                    fullData = loadData();
                    filteredData = [...fullData];
                    
                    if (els.searchInput.value) {
                         const term = els.searchInput.value.toLowerCase().trim();
                         filteredData = fullData.filter(item => item.en.toLowerCase().includes(term) || item.vi.toLowerCase().includes(term));
                    }
                    
                    if (currentIndex >= filteredData.length) currentIndex = Math.max(0, filteredData.length - 1);
                    renderCard();
                }
            } else {
                alert("Kh√¥ng th·ªÉ x√≥a th·∫ª m·∫∑c ƒë·ªãnh!");
            }
        });

        // --- IMPORT/EXPORT ---
        els.btnExport.addEventListener('click', () => {
            const personal = localStorage.getItem('my_flashcards') || "[]";
            const mastered = localStorage.getItem('my_mastered_list') || "[]";
            const exportData = { cards: JSON.parse(personal), mastered: JSON.parse(mastered) };
            const dataStr = JSON.stringify(exportData);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', 'mesbox_backup.json');
            linkElement.click();
        });

        els.btnImport.addEventListener('click', () => els.fileImport.click());
        els.fileImport.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (event) => {
                try {
                    const imported = JSON.parse(event.target.result);
                    let newCards = [];
                    let newMastered = [];

                    if (Array.isArray(imported)) {
                        newCards = imported; 
                    } else if (imported.cards) {
                        newCards = imported.cards;
                        newMastered = imported.mastered || [];
                    }

                    const storedCards = JSON.parse(localStorage.getItem('my_flashcards') || "[]");
                    let countAdded = 0;
                    newCards.forEach(c => {
                        if (!storedCards.some(old => old.en.toLowerCase() === c.en.toLowerCase())) {
                            storedCards.unshift(c);
                            countAdded++;
                        }
                    });
                    localStorage.setItem('my_flashcards', JSON.stringify(storedCards));

                    const storedMastered = JSON.parse(localStorage.getItem('my_mastered_list') || "[]");
                    newMastered.forEach(m => {
                        if (!storedMastered.includes(m)) storedMastered.push(m);
                    });
                    localStorage.setItem('my_mastered_list', JSON.stringify(storedMastered));

                    fullData = loadData();
                    filteredData = [...fullData];
                    renderCard();
                    alert(`ƒê√£ nh·∫≠p: ${countAdded} t·ª´ m·ªõi.`);
                } catch (err) { alert("File l·ªói!"); }
            };
            reader.readAsText(file);
            e.target.value = '';
        });

        // --- SEARCH, SWIPE, KEYBOARD ---
        els.searchInput.addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase().trim();
            filteredData = fullData.filter(item => 
                item.en.toLowerCase().includes(term) || 
                item.vi.toLowerCase().includes(term)
            );
            currentIndex = 0;
            isFlipped = false;
            els.cardInner.classList.remove('card-flipped');
            renderCard();
        });

        els.flashcardArea.addEventListener('click', flipCard);
        els.btnNext.addEventListener('click', nextCard);
        els.btnPrev.addEventListener('click', prevCard);
        els.btnSpeakFront.addEventListener('click', (e) => { e.stopPropagation(); speak(filteredData[currentIndex].en); });
        els.btnSpeakBack.addEventListener('click', (e) => { e.stopPropagation(); speak(filteredData[currentIndex].en); });

        let touchStartX = 0; let touchStartY = 0; const minSwipeDistance = 50;
        document.addEventListener('touchstart', (e) => {
            if (e.target.closest('#add-modal')) return;
            touchStartX = e.changedTouches[0].screenX; touchStartY = e.changedTouches[0].screenY;
        }, { passive: true });
        document.addEventListener('touchend', (e) => {
            if (e.target.closest('#add-modal')) return;
            const dX = touchStartX - e.changedTouches[0].screenX;
            const dY = touchStartY - e.changedTouches[0].screenY;
            if (Math.abs(dX) > Math.abs(dY) && Math.abs(dX) > minSwipeDistance) dX > 0 ? nextCard() : prevCard();
        }, { passive: true });
        window.addEventListener('keydown', (e) => {
            if (document.activeElement === els.searchInput || !els.addModal.classList.contains('hidden')) return;
            if (e.key === 'ArrowRight') nextCard();
            if (e.key === 'ArrowLeft') prevCard();
            if (e.key === ' ' || e.key === 'Enter') { e.preventDefault(); flipCard(); }
        });

        // Init PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => navigator.serviceWorker.register('./sw.js'));
        }

        renderCard();
    </script>
</body>
</html>
